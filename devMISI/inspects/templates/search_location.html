{% extends 'base.html' %} 
{% block content %}

{% load static %}
<!-- <script type="text/javascript"  src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script> 

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">  -->

<link rel="stylesheet" type="text" href="{% static '/bootstrap-4.0.0/dist/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/bootstrap.min.css' %}">

<link href="{% static '/css/bootstrap-toggle.min.css' %}" rel="stylesheet">
<script src="{% static '/js/bootstrap-toggle.min.js' %}"></script>

    <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/select2.min.css' %}">
<link rel="stylesheet" href="{% static '/css/jquery-ui.css' %}">

<!-- <link rel="stylesheet" href="{% static '/css/font-awesome.min.css' %}"> -->

<script src="{% static 'js/timepicker.js' %}"></script>
<!-- <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" /> -->

  <script src="{% static '/js/jquery.min.js' %}"></script>
   <!-- Select2 CSS --> 

<!-- jQuery --> <script src="{% static '/js/jquery.min4.js' %}"></script> 

<!-- Select2 JS --> 
<script src="{% static '/js/select2.min.js' %}"></script>
<!-- Load icon library -->
<!-- <link rel="stylesheet" href="{% static '/css/font-awesome.min.css' %}"> -->
<!-- multiple selesct marked officer -->

<!-- <link href="css/jquery.multiselect.css" rel="stylesheet" type="text/css"> -->
<script src="{% static '/js/jquery.dataTables.min.js' %}"></script>
  <link href="{% static '/css/jquery.dataTables.min.css' %}"  rel="stylesheet"/>
  <!-- Sheets for datepicker for target date -->
  
  <link rel="stylesheet" href="{% static '/css/jquery-ui.css' %}">
  <!-- <link rel="stylesheet" href="/resources/demos/style.css"> -->
  <script src="{% static '/js/jquery-ui.js' %}"></script>

<link href="{% static '/css/select2.min.css' %}" rel="stylesheet" />
<script src="{% static '/js/select2.min.js' %}" defer></script>

<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="{% static '/js/jquery-3.6.0.min.js' %}"></script>

  <link rel="stylesheet" type="text/css" href="{% static '/css/jquery.dataTables.min.css' %}">
 
  <script type="text/javascript" charset="utf8" src="{% static '/js/jquery.dataTables.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/css/lato.css' %} ">
  <link rel="stylesheet" type="text/css" href="{% static '/css/quicksand.css' %} ">
  <br>
  {% comment %} 
  <script type="text/javascript" src="{% static '/js/jquery.min.js' %}"></script> 
  {% endcomment %}
  <script type="text/javascript" src="{% static '/js/moment.min.js' %}"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<style>
        input[type=text],
        select {
                width: 100%;
                padding: 12px 20px;
                margin: 8px 0;
                display: block;
                color: rgb(38, 38, 38);
                border-radius: 4px;
                box-sizing: border-box;
                height:40px;
        }

        input[type=submit] {
                width: 20%;
                text-align: center;
                background-color: #4CAF50;
                color: rgb(15, 12, 12);
                padding: 14px 20px;
                margin: 8px 0;
                border: none;
                border-radius: 4px;
                cursor: pointer;
        }

        input[type=submit]:hover {
                background-color: #45a049;
                text-align: center;
        }

        input[type=button] {
                width: 10%;
                text-align: center;
                background-color: #4CAF50;
                color: white;
                padding: 6px 6px;
                margin: 8px 0;
                border: none;
                border-radius: 4px;
                cursor: pointer;
        }

        input[type=button]:hover {
                background-color: #45a049;
                text-align: center;
        }
  #viewbtn {
    margin-left: 1200px;
    margin-right: 10px;
  }
  
/* Add Animation */
@-webkit-keyframes animatetop {
  from {top:-300px; opacity:0} 
  to {top:0; opacity:1}
}

@keyframes animatetop {
  from {top:-300px; opacity:0}
  to {top:0; opacity:1}
}

/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}


         
</style>

<h3 align="center" ><u><b>Search Inspections Report </b></u></h3>
<br>

<form action="{% url 'search_location' %}" method="POST" id='indexForm'> 
  {% csrf_token %}
  
    <div class="row" style="margin-left: 5em; margin-right: 5em;">

      <div class="col form-group">
        <label for="rly_id" >Railways<span style="color:red;font-weight:bold">*</span></b></label>
        <select class="form-control" id="location_code" style="height:300px;" name="location_code" class="custom-select">
            <option value="All" selected>All</option>
            {% for z in zone %}
            <option value="{{z}}">{{z}}</option>
            {% endfor %}

        </select>
      </div>
      
      <div class="col form-group">
            <label for="div_id">Division<span style="color:red;font-weight:bold">*</span></label>
            <select class="form-control" id="location_type" style=" height:40px;" name="location_type" class="custom-select" style="max-width:100%;"
                     required>
        
                    <option value="All" selected>All</option>
                    {% for d in division %}
                    <option value="{{d}}">{{d}}</option>
                    {% endfor %}
        
            </select>
            
      </div>

      <div class="col form-group">
        <label for="department_name">Department <span style="color:red;font-weight:bold">*</span></label>
        <select class="form-control" id="dept" name="dept" style=" height:40px;" class="custom-select" style="max-width:100%;"
                 required>
    
                {% comment %} <option value="All" selected>All</option> {% endcomment %}
                {% for d in dept %}
                <option value="{{d}}">{{d}}</option>
                {% endfor %}
    
        </select>
        
      </div>

      <div class="col form-group">
        <label for="designation" >Designation<span style="color:red;font-weight:bold">*</span></b></label>
        <select class="form-control" id="designation"style=" height:40px;" name="designation" class="custom-select"
             required>
            <option value="All" selected>All</option>
            {% comment %} {% for d in desi %}
            <option value="{{d}}">{{d}}</option>
            {% endfor %} {% endcomment %}

        </select>
      </div>

      <div class="col form-group">
        <label for="Status" >Status </label>
        <select class="form-control" style=" height:40px;" id="Status" name="Status" class="custom-select">
            <option value="All" >All</option>
            <option value="Pending" >Pending</option>
            <option value="Partial" >Partial</option>
            <option value="Complete" >Complete</option>

        </select>
      </div>

      <div class="col form-group">
        <label for="Zone" >Date Range</label>

        <div id="inspected_on" style="background: #fff; cursor: pointer; padding: 1px; border: 1px solid #ccc; height:30px;width: 100%">
          
          <i class="fa fa-calendar"></i>&nbsp;
          <span></span> 
          <!-- <i class="fa fa-caret-down"></i> -->

        </div>
      </div>

          <button type="button" onclick="myFunction()" style="margin-top:25px;height:3em;width:6em;" 
          class="btn btn-success btn-sm">Search</button>

    </div>


      

</form>
<br>

<form action="{% url 'keyword_location_search' %}"  method="POST" id='indexForms'>
  {% csrf_token %}
  

  <div class="row" id ='search_text' style="margin-left: 5em; margin-right: 5em; display:none;">

      <div class="col-sm-6 form-group" >
        <input class="form-control" id="query" name="query"
        class="custom-select">
          
      </div>

        <div  class="col-sm-6 form-group" >
          <button type="submit" style="height:3em;width:6em;" 
          class="btn btn-success btn-sm" >Search</button>
        </div> 
  </div>

  &nbsp;
  &nbsp;
  <div class="col" id ='search_text' style="margin-left: 5em; margin-right: 5em;">
    <input type="checkbox" id="check"> Observation Search</legend>    
  </div>


</form>

<br>

    <!-- <form method='POST'  class="form-inline my-2 my-log-0">
      {% csrf_token %}
      <div class="row" style="margin-left: 15em; margin-right: 15em;">

        <div class="col-sm-6 form-group">
          <label for="location_description" >Keyword Search</b></label>
          <input class="form-control" id="query" name="query"
           class="custom-select">
             
      </div>
      <div class="col-sm-6 form-group">
        <label for="location_description" >Search By Person</b></label>
        <input class="form-control" id="location_description" name="location1" class="custom-select"
       value='{{q}}' >

           
      </div>

      <div class="row" style="margin-left: 10em; margin-right: 10em;">
        <div  class="col-sm-2s form-group pull-right" >
          <button type="submit" value="Submit" style="margin-top:2.7em;height:3em;width:6em;" 
          class="btn btn-success btn-sm pull-right">Submit</button>
        </div>
      </div>
  

  
       
 
        
    </div>

      </form> -->


    <!-- <div class="row" style="margin-left: 20em; margin-right: 20em;">
        <div  class="col-sm-2s form-group pull-right" >
          <label ></label>
          <button  type="submit"  name="zone_loc_submit"  style="margin-top:2.7em;height:3em;width:6em;" class="btn btn-success btn-sm pull-right" >Submit</button>
        </div>
     </div> -->

    
      


<form action="{% url 'search_location' %}" method="POST" id='indexForm'> 
    {% csrf_token %}
  <div class="box-body no-padding" style="margin-left: 5em; margin-right: 5em;">
    <table id="tableid" name="tableid" class="table table-striped table-bordered table-sm " cellspacing="0">
        <thead style="background-color: #343a40;white-space: nowrap; color:white;text-align: left;">
          
        <tr>
            <th>Sr No.</th>
            <th>Inspection Note No</th>
            <th>Date</th>
            <th>Department</th>
            <th>Division</th>
            <th>Railways</th>
            <th>View</i></th>                            
        </tr>
        </thead>

        <tbody>

  

        </tbody>
   
  </table>

    <!-- /.box-body -->

  </div>

</form>
   


<script>





  $(document).ready(function() {
  $('.form-control').select2();
  });


  $(function() {

    var start = moment().subtract(29, 'days');
    var end = moment();

    function cb(start, end) {
        $('#inspected_on span').html(start.format('MM-D-YY') + ' ' + end.format('MM-D-YY'));
    }

    $('#inspected_on').daterangepicker({
        startDate: start,
        endDate: end,
        ranges: {
           'Today': [moment(), moment()],
           'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
           'Last 7 Days': [moment().subtract(6, 'days'), moment()],
           'Last 30 Days': [moment().subtract(29, 'days'), moment()],
           'This Month': [moment().startOf('month'), moment().endOf('month')],
           'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        }
    }, cb);

    cb(start, end);

});


$("#location_type").change(function(){
  var groupss= $('#location_type').val();
  //var group=$('#location_type').val()
    //alert(groupss)
  //alert("heree")
  $.ajax({
    type:'GET',
    url:"{% url 'search_desig_ajax' %}",
    dataType:'json',
    data:{
      groupss
    },
    success:function (response){
      //alert("hereeee")
      console.log('0000000000', response)
      //$("#designation").find('option').remove();
      for (i=0; i<response.ins.length; i++){
        $('#designation').append(`<option>${response.ins[i].designation}</option>`);
        
      }
    }
  });
})


$("#location_code").change(function(){
  var group=$('#location_code').val()
    //alert(group)
  //alert("heree")
  $.ajax({
    type:'GET',
    url:"{% url 'search_locat_ajax' %}",
    dataType:'json',
    data:{
      group
    },
    success:function (response){
      //alert("hereeee")
      console.log(response)
      $("#location_type").find('option').remove();
      $('#location_type').append();
      for (i=0; i<response.ins.length; i++){
        $('#location_type').append(`<option value="${response.ins[i].rly_unit_code}">${response.ins[i].location_code}</option>`);
        
      }
    }
  });
})


//show data in 
  function myFunction() {
    //if ("#indexForms" ==true) {
  
    count=0;
    //document.getElementById("#myFunction");
    var location_code=$('#location_code').val()
    var location_type=$('#location_type').val()
    var designation=$('#designation').val()
    var dept=$('#dept').val()
    var inspected_on=$('#inspected_on').val()
  $.ajax({
    type:'GET',
    url:"{% url 'fetch_desig_ajax' %}",
    dataType:'json',
    data:{
      location_code,location_type,designation,dept,inspected_on
    },
    success: function (response) {
      $('#tableid tbody').empty();
      if(count!=0)
        {
          var table = $('#tableid').DataTable();
          table.destroy();
        } 
          count=1;
          //myhtml = '';
          myhtml2='';
  
          console.log(response,"$$$$$$$$")

                    
          $('#tableid tbody').empty();        
          for (i = 0; i <response.length; i++) {
          console.log("@@@@@@@@@@");

          myhtml2 += '<tr> <td>' + [i+1] +'</td> <td>' + response[i].inspection_note_no+'</td> <td>' + response[i].inspected_on+'</td> <td>' + response[i].dept+'</td> <td>' + response[i].division+ '</td> <td>' + response[i].zone+'</td><td><a href="/search_location_detail/'+response[i].inspection_no+'/">pdfview</a></td></tr>'
        }
        $('#tableid tbody').append(myhtml2);
        $('#tableid').show();
        $('#tableid').DataTable();                   
  }
    
  });
    }
  /*}
else {
 document.getElementById("#indexForms" ==true)
}

}
*/

 



</script>
<script>


  $(document).ready( function () {
    
});


 </script>


<script>
  $("#check").click(function(){
    var value = $("#check").is(':checked');
    if(value){
      console.log("inside value")
      $("#search_text").show();
    }
    else{
      console.log('insode else')
      $("#search_text").hide();
    }
  });
</script>



{% endblock %}  

