{% extends 'base.html' %} 
{% block content %}
{% load static %}

<head>
    <script src="{% static '/js/bootstrap.min.js' %}"></script>
    <script src="{% static '/js/jquery.min.js' %}"></script>
    <script src="{% static '/js/popper.min.js' %}"></script>
    <script type="text/javascript" src="{% static '/bootstrap-4.0.0/dist/js/bootstrap.min.js'%}"></script>
    <script type="text/javascript" src="{% static '/bootstrap-4.0.0/dist/js/bootstrap.bundle.min.js'%}"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/bootstrap.min.css' %}">
    <script src="{% static '/js/jquery-3.3.1.js' %}"></script>
    <script src="{% static '/DataTables/datatables.min.js' %}"></script>
    <script src="{% static '/js/dataTables.bootstrap4.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/DataTables/datatables.min.css' %}" />
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="{% static '/js/select2.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/select2.min.css' %}">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="{% static '/js/select2.min.js' %}"></script>
    <script src="{% static 'js/timepicker.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="{% static '/js/select2.min.js' %}"></script>
</head> 
    
<style>
    * {
        box-sizing: border-box;
    }
    .input,
    input[type=text]
    {
        width: 100%;
        padding: 12px 20px;
        margin: 2px 0;
        display: block;
        /* border: 1.5px solid rgb(14, 12, 12); */
        resize: vertical;
        border-radius: 4px;
        box-sizing: border-box;
    }
    input[type=submit] 
    {
        width: 40%;
        text-align: center;
        background-color: #4CAF50;
        color: rgb(15, 12, 12);
        padding: 14px 20px;
        margin: 2px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    input[type=submit]:hover 
    {
        background-color: #45a049;
        text-align: center;
    }
    input[type=button] 
    {
        width: 30%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 6px 6px;
        margin: 2px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
    input[type=button]:hover 
    {
        background-color: #45a049;
        text-align: center;
    }
      /* #viewbtn{
        margin-left:1050px;
      } */
    .inputtag
    {
        height:20px;
    }
    .modal-dialog-full-width 
    {
        width: 100% !important;
        height: 100% !important;
        margin: 0 !important;
        padding: 3% !important;
        max-width:none !important;
        text-align: center !important;
    }
    .modal-content-full-width  
    {
        height: auto !important;
        min-height: 100% !important;
        border-radius: 0 !important; 
        text-align: center !important;  
    }
    .modal-header-full-width  
    {
        border-bottom: 0px solid #9ea2a2 !important;
    }
    .modal-footer-full-width  
    {
        border-top: 0px solid #9ea2a2 !important;
    }
    .autocomplete 
    {
      /*the container must be positioned relative:*/
      position: relative;
      display: inline-block;
    }
    .autocomplete-items 
    {
      position: absolute;
      border: 1px solid #d4d4d4;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      /*position the autocomplete items to be the same width as the container:*/
      top: 100%;
      left: 0;
      right: 0;
    }
    .autocomplete-items div 
    {
      padding: 10px;
      cursor: pointer;
      background-color: #fff;
      border-bottom: 1px solid #d4d4d4;
    }
    .autocomplete-items div:hover 
    {
      /*when hovering an item:*/
      background-color: #e9e9e9;
    }
    .autocomplete-active 
    {
      /*when navigating through the items using the arrow keys:*/
      background-color: DodgerBlue !important;
      color: #ffffff;
    }
</style>

<body>
    <h3><center>Item-Wise Pendency of Inspections Done by Others</center></h3> 
    <br>

    <div class="container" id="container1" style="text-align: center;" >
        <div class="row" style="text-align: center; padding-left: 12em;" >
            <div class="col-md-2"  style="margin-left:2em ;">
                <label for="Zone" >Rly/Org</label>
                <select class="form-control" name="rly_id" id="rly_id" class="custom-select" style="max-width:100%;">
                    <option value="" selected>All</option>
                    {% for z in zone %}
                    <option value="{{z}}">{{z}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label for="division">Division</label>
                <select class="form-control" name="div_id" id="div_id" class="custom-select" style="max-width:100%;">
                    <option value="" selected>All</option>
                    {% for d in division %}
                    <option value="{{d}}">{{d}}</option>
                    {% endfor %}
                </select>  
            </div>
            <div class="col-md-2">
                <label for="division">Department</label>
                <select class="form-control" name="dept_id" id="dept_id" class="custom-select" style="max-width:100%;">
                    <option value="" selected>All</option>
                    {% for d in dept %}
                    <option value="{{d}}">{{d}}</option>
                    {% endfor %}
                </select> 
            </div>
            <!-- <div  class="col-md-2" >
                <label for="location" >Location</label><br>
                <div class="autocomplete">
                    <input  id="location" autocomplete="off" maxlength="20"  style="height: 2.25em;" required class="form-control" type="text" class="form-control" value="{{ins_detail.location}}"/>
                </div>    
            </div> -->
            <div class="col-md-1 form-group">
                <button type="button" id="submit_filter" style="margin-top:2em;width:5em;margin-left:3%;border: 1px solid #ccc;" class="btn btn-success" onclick="pending_filterdata(this);">Search</button>
            </div>
            &nbsp; &nbsp; &nbsp; &nbsp;
            <div class="col-md-1 form-group" >
                <button type="button" style="margin-top:2em;width:5em;margin-left:3%;border: 1px solid #ccc;"class="btn btn-secondary" onclick="compliance_alterdata();">Clear</button>
            </div>
        </div>
        <br>
    </div> 
    <br>
    <div class="container">
        <table id="tableshow" class="table table-striped table-bordered table-lg" cellspacing="0">
        <thead style="background-color:black; color:white">
            <tr style="text-align:left">
                <th>S.No.</th>
                <th>Insp. Note No.</th>
                <!-- <th>Item No.</th> -->
                <th>Observation</th>
                <th>Insp. Date</th>
                <th>Insp. Officer</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for i in listgrid %}
            <tr style="text-align:left">
                <td style="width:5%">{{forloop.counter}}</td>
                <td style="width:20%">{{i.inspection_note_no}}</td>
                <!-- <td>{{i.item_no}}</td> -->
                <td style="width:40%">{{i.observation}}</td>
                <td style="width:11%">{{i.inspected_on}}</td>
                <!-- {% if i.start_date or i.end_date %}
                    <td>{{i.start_date|date:"d-m-y" }} to {{i.end_date|date:"d-m-y" }}</td>
                {% else %}
                    <td>NA</td>
                {% endif %} -->
                <td style="width:12%">{{i.inspecting_officer}}</td>
                <td style="width:10%"><button type="button" class="btn btn-primary"><a href="{% url 'inspectionReportPdf' i.inspection_no %}" style="color: black;" target="blank">Report</button></a></td>
            </tr>
        {% endfor %}  
        </tbody>
    </table>
    </div> 

    <br><br>
</body>

<script>
    function auto(inp, arr) 
    {
        var currentFocus;
        inp.addEventListener("input", function(e) {
            var a, b, i, val = this.value;
            closeAllLists();
            if (!val) 
            { return false;}
            currentFocus = -1;
            a = document.createElement("DIV");
            a.setAttribute("id", this.id + "autocomplete-list");
            a.setAttribute("class", "autocomplete-items");
            this.parentNode.appendChild(a);
            for (i = 0; i < arr.length; i++) 
            {
                if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) 
                {
                    b = document.createElement("DIV");
                    b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                    b.innerHTML += arr[i].substr(val.length);
                    b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                    b.addEventListener("click", function(e) {
                        inp.value = this.getElementsByTagName("input")[0].value;
                        closeAllLists();
                    });
                    a.appendChild(b);
                }
            }
        }
    );

    inp.addEventListener("keydown", function(e) {
        var x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) 
        {
            currentFocus++;
            addActive(x);
        } 
        else if (e.keyCode == 38) 
        { 
            currentFocus--;
            addActive(x);
        } 
        else if (e.keyCode == 13) 
        {
            e.preventDefault();
            if (currentFocus > -1) 
            {
                if (x) x[currentFocus].click();
            }
        }
    });
    function addActive(x) 
    {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        x[currentFocus].classList.add("autocomplete-active");
    }
    function removeActive(x) 
    {
    
        for (var i = 0; i < x.length; i++) 
        {
            x[i].classList.remove("autocomplete-active");
        }
    }
    function closeAllLists(elmnt) 
    {
    
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) 
        {
            if (elmnt != x[i] && elmnt != inp) 
            {
                x[i].parentNode.removeChild(x[i]);
            }
        }
    }

    document.addEventListener("click", function (e) {
        closeAllLists(e.target);
    });
    }

    $( document ).ready(function() 
    {
        var loc = []
        $.ajax({
            url: '{% url "autoFetchLocation" %}',
            dataType: 'json',
            type: 'GET',
            success: function(response)
            {
                for(i in response)
                {
                    loc.push(response[i])
                }
                console.log(response)
            }
        })
        auto(document.getElementById("location"), loc);
    });
</script>

<script> 
    $( document ).ready
    (
        function() 
        {
            $('#tableshow').DataTable();
            $('#container1').hide();
            pending_forme();
        }
    );

    $('#mytable').hide();
    $("#rly_id").select2();
    $("#div_id").select2();
    $("#dept_id").select2();

    $('#rly_id').change(function() 
    {
        var rly_id=$('#rly_id').val();
        data=
        {
            'rly_id':rly_id,
            'str':'filter',
        }
        $.ajax
        ({
            url: "{% url 'compliance_filterdata_ajax' %}",
            method: "GET",
            dataType: "JSON",
            async: false,
            data: data,
            success: function (response) 
            {
                div=response.div;
                $('#div_id').empty();
                $('#div_id').append(`<option value="">All</option>`);
                for (let i = 0; i < div.length; i++) 
                {
                    $('#div_id').append
                    (
                        `<option value="${div[i]}">
                        ${div[i]}
                        </option>`);
                }
            }
        })   
    });

    // clear button
    function compliance_alterdata()
    {
        $.ajax
        ({
            url:"{% url 'compliance_alterdata' %}",
            method:"GET",
            dataType:"JSON",
            async: false,
            success: function(response)
            {
                change_div=response.change_div;
                change_rly=response.change_rly;
                change_dept=response.change_dept;
                $('#div_id').empty();
                $('#div_id').append(`<option value="">All</option>`);
                $('#rly_id').empty();
                $('#rly_id').append(`<option value="">All</option>`);
                $('#dept_id').empty();
                $('#dept_id').append(`<option value="">All</option>`);
                for (let i = 0; i < change_div.length; i++) 
                {$('#div_id').append
                    (
                        `<option value="${change_div[i]}">${change_div[i]}</option>`
                    );
                }
                for (let i = 0; i < change_rly.length; i++) 
                {$('#rly_id').append
                    (
                        `<option value="${change_rly[i]}">${change_rly[i]}</option>`
                    );
                }
                for (let i = 0; i < change_dept.length; i++) 
                {$('#dept_id').append
                    (
                        `<option value="${change_dept[i]}">${change_dept[i]}</option>`
                    );
                }
            }
        })
    }

    function pending_filterdata(e)
    {
        var table = $('#tableshow').DataTable();
        table.destroy();
        $('#tableshow').hide();
        var str=e.id;
        // alert(str); 
        // $('#tableshow').hide();
        // $('#tableshow').DataTable().clear().destroy();
        var data={}
        if(str=='submit_filter')
        {
            var rly_id=$('#rly_id').val();
            // alert(rly_id)
            var div_id=$('#div_id').val();
            // alert(div_id)
            var dept_id=$('#dept_id').val();
            // alert(dept_id)
            data=
            {
                'div_id':div_id,
                'rly_id':rly_id,
                'dept_id':dept_id,
                'str':'for_me',
                // 'location':location,
            }
        }
        $.ajax
        ({
            url: "{% url 'pending_item_filterdata' %}",
            method: "GET",
            dataType: "JSON",
            async: false,
            data: data,
            success: function (response) 
            {
                let filterdata = response.item_details;
                let row = "";
                let head = 
                    `<thead style="background-color:black; color:white">
                        <tr>
                            <th>S.No.</th>
                            <th>Insp. Note No.</th>
                            <th>Observation</th>
                            <th>Insp. Date</th>
                            <th>Insp. Officer</th>
                            <th>Action</th>
                        </tr>
                    </thead>`;
                for (let i = 0; i < filterdata.length; i++) 
                {
                    row += "<tr text-align:left>";
                    row += `<td width:5%>${filterdata[i]['sr_no']}</td>
                    <td width:20%>${filterdata[i]['inspection_note_no']}</td>
                    <td width:40%>${filterdata[i]['observation']}</td>
                    <td width:11%>${filterdata[i]['inspected_on']}</td>
                    <td>${filterdata[i]['inspecting_officer']}</td>
                    <td width:10%><button type="button" class="btn btn-primary"><a href="inspectionReportPdf/${filterdata[i]['inspection_no']}" style="color: white;" target="blank" onclick="viewdate(this)">Report</a></button></td>`
                    row += "</tr>";                    
                }
                $('#tableshow thead').remove();
                $('#tableshow tr').remove();
                $('#tableshow').append(head);
                $('#tableshow tbody').append(row);
                $('#tableshow').show();
                $('#tableshow').DataTable();
            }
        })
    }
    
    function pending_forme()
    {
        $('#container1').show();
        $('#tableshow').show();
    }

</script>

{% endblock %}  
