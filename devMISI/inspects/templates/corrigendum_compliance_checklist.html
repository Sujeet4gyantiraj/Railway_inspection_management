{% extends 'base.html' %} 
{% block content %}
{% load static %}
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery.min.js"></script>
<!-- <link rel="stylesheet" href="jquery.dropdown.css"> -->
<script src="jquery.dropdown.js"></script>
<!-- Include the plugin's CSS and JS: -->

<script type="text/javascript" src="js/bootstrap-multiselect.js"></script>
<link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css"/>
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->

<link rel="stylesheet" type="text" href="{% static '/bootstrap-5.1.3-dist/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/bootstrap.min.css' %}">

<link href="{% static '/css/bootstrap-toggle.min.css' %}" rel="stylesheet">
<script src="{% static '/js/bootstrap-toggle.min.js' %}"></script>

    <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
    <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/select2.min.css' %}">
<link rel="stylesheet" href="{% static '/css/jquery-ui.css' %}">

<link rel="stylesheet" type="text/css" href="{% static '/css/quicksand.css' %} ">
     
<link rel="stylesheet" href="{% static '/css/font-awesome.min.css' %}">

<script src="{% static 'js/timepicker.js' %}"></script>
<!-- <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" /> -->

  <script src="{% static '/js/jquery.min.js' %}"></script>
   <!-- Select2 CSS --> 

<!-- jQuery --> <script src="{% static '/js/jquery.min4.js' %}"></script> 

<!-- Select2 JS --> 
<script src="{% static '/js/select2.min.js' %}"></script>
<!-- Load icon library -->
<link rel="stylesheet" href="{% static '/css/font-awesome.min.css' %}">
<!-- multiple selesct marked officer -->

<link href="css/jquery.multiselect.css" rel="stylesheet" type="text/css">
<script src="{% static '/js/jquery.dataTables.min.js' %}"></script>
  <link href="{% static '/css/jquery.dataTables.min.css' %}"  rel="stylesheet"/>
  <!-- Sheets for datepicker for target date -->
  
  <link rel="stylesheet" href="{% static '/css/jquery-ui.css' %}">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="{% static '/js/jquery-ui.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static '/css/lato.css' %} ">

  
  <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
     

<style>
      * {
  box-sizing: border-box;
}

    
      input[type=text]
      {
              width: 100%;
              padding: 12px 20px;
              margin: 8px 0;
              display: block;
              /* border: 1.5px solid rgb(14, 12, 12); */
              border-radius: 4px;
              box-sizing: border-box;
      }
    
      input[type=submit] {
              width: 40%;
              text-align: center;
              background-color: #4CAF50;
             
              padding: 14px 20px;
              margin: 8px 0;
              border: none;
              border-radius: 4px;
              cursor: pointer;
      }
    
      input[type=submit]:hover {
              background-color: #45a049;
              text-align: center;
      }
    
    
      input[type=button]:hover {
              background-color: #45a049;
              text-align: center;
      }
      /* #viewbtn{
        margin-left:1050px;
      } */
    
      .inputtag{
        height:20px;
      }
.button {
  padding: 15px 25px;
  font-size: 12px;
  text-align: center;
  margin-left: 2em;
  cursor: pointer;
  outline: none;
  color: #fff;
  background-color: #04AA6D;
  border: none;
  border-radius: 15px;
 
}

.button:hover {background-color: #3e8e41}

.button:active {
  background-color: #3e8e41;
  box-shadow: 0 5px #666;
  transform: translateY(4px);
}


    
.modal-dialog-full-width 
    {
        width: 100% !important;
        height: 100% !important;
        margin: 0 !important;
        /* padding-left: 5% !important;
        padding-right: 5% !important;
        padding-top: 5% !important;
        padding-bottom: 5% !important; */
        padding: 3% !important;
        max-width:none !important;
        text-align: center !important;
    }
    .modal-content-full-width  
    {
        height: auto !important;
        min-height: 100% !important;
        border-radius: 0 !important; 
        text-align: center !important;  
    }
    .modal-header-full-width  
    {
        border-bottom: 0px solid #9ea2a2 !important;
    }
    .modal-footer-full-width  
    {
        border-top: 0px solid #9ea2a2 !important;
    }
</style>
    
  
<body>
<h3 style="font-family: 'Lato', sans-serif;">
    <center><b>Inspections Reverted Compliance</b></center>
  </h3>
  <div class="container">
    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'success' %}
              <div class="alert alert-success">
                <strong>Success </strong>{{ message }}
              </div>
            {% elif message.tags == 'error' %}
              <div class="alert alert-danger">
                <strong>Error </strong>{{ message }}
              </div>
            {% elif message.tags == 'info' %}
              <div class="alert alert-info">
                <strong>Info </strong>{{ message }}
              </div>
            {% else %}
            
            {% endif %}
           
        
        {% endfor %}
    {% endif %}
  </div>
  <br>
  

  <div class="container" style="font-family:'Lato', sans-serif">
    <!-- <form  method="POST" class="d-inline " >
          
      {% csrf_token %}
  
  
     
    
  
  <div class="row" id="row1" style="font-family: 'Lato', sans-serif;font-size: 1em;">
      <div class="col-2"  >
          <label for="Zone" >Rly./Org.</label>
          <select class="form-control" id="zone" name="zone" class="custom-select"
              multiple ><span style="color:red;font-weight:bold">*</span>
              <option value="" disabled>select</option>
              {% for z in Zone %}
              <option value="{{z}}">{{z}}</option>
              {% endfor %}
  
          </select>
      </div>
  
     
     
  <div class="col-2">
      <label for="division">Div./Unit</label>
      <select class="form-control" id="division" name="division" class="custom-select" style="max-width:100%;"
      multiple><span style="color:red;font-weight:bold">*</span>
  
              <option value="" disabled>select</option>
              {% for d in division %}
              <option value="{{d}}">{{d}}</option>
              {% endfor %}
  
          </select>
      
  </div>
  <div class="col-2">
    <label for="division">Department</label>
    <select class="form-control" id="department" name="department" class="custom-select" style="max-width:100%;" multiple>
  
            <option value="" disabled>select</option>
            {% for d in department %}
            <option value="{{d.department_name}}">{{d.department_name}}</option>
            {% endfor %}
  
        </select>
    
  </div>
  
  <div  class="col-2" >
    <label for="location" >Location</label><br>
    <div>
      <select name="location" id="location" class="form-control"  multiple>
  
      </select>
    </div>
    
  </div>


  <div  class="col-3" >
    <label for="location">Date Range</label><br>
    <div id="date_range" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
      <i class="fa fa-calendar"></i>&nbsp;
      <span></span> <i class="fa fa-caret-down"></i>
  </div>
    
    
  </div>

  <div  class="col-1" >
   
    <button  type="button"  name="zone_loc_submit"  style="margin-top:2em; " class="btn btn-success" id="insp_submit" onclick="getSearchValue()">Search</button>
  </div>
   

    
    </form> -->

    
    <form  method="POST" class="d-inline " >
          
      {% csrf_token %}
  
  <div class="row" id="row1" style="font-family: 'Lato', sans-serif;font-size: 1em; margin-left: 4em;">

      <div  class="col-3" >
        <label for="location">Date Range</label>
        <div id="date_range" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
          <i class="fa fa-calendar"></i>&nbsp;
          <span></span> <i class="fa fa-caret-down"></i>
        </div>
      </div>

      <div class="col-3"  >
          <label for="Zone" >Rly./Org. Wise </label>
          <select class="form-control" id="zone" data-placeholder="Rly./Org Wise..." name="zone" class="custom-select"
              multiple ><span style="color:red;font-weight:bold">*</span>
              <option value="" disabled>select</option>
              {% for z in Zone %}
              <option value="{{z}}">{{z}}</option>
              {% endfor %}
  
          </select>
      </div>
  
     
     
  <div class="col-3">
      <label for="division">Div./Unit Wise</label>
      <select class="form-control" id="division" data-placeholder="Div./Unit Wise..." name="division" class="custom-select" style="max-width:100%;"
      multiple><span style="color:red;font-weight:bold">*</span>
  
              <option value="" disabled>select</option>
              {% for d in division %}
              <option value="{{d}}">{{d}}</option>
              {% endfor %}
  
          </select>
      
  </div>

  <div class="col-2" hidden>
    <label for="division">Department Wise</label>
    <select class="form-control" id="department"  name="department" class="custom-select" style="max-width:100%;" multiple>
  
            <option value="" disabled>select</option>
            {% for d in department %}
            <option value="{{d.department_name}}">{{d.department_name}}</option>
            {% endfor %}
  
    </select>
    
  </div>
  
  <div  class="col-2" hidden>
    <label for="location" >Location Wise</label><br>
    <div>
      <select name="location" id="location" class="form-control"  multiple>
  
      </select>
    </div>
    
  </div>
  
  <div  class="col-2" >
   
    <button  type="button"  name="zone_loc_submit"  style="margin-top:2em; " class="btn btn-success" id="insp_submit" onclick="getSearchValue()">Search</button>
  </div>
   

    
</form>
  </div>
  <br><br>

  <div class="modern" style="font-family:'Lato', sans-serif">
    <table id="instituteTable" class="table table-striped table-bordered table-sm;" style="margin-left:-2em" >
    <thead  style="background-color: #343a40;white-space: nowrap;font-size: 1.1em; color:white;text-align: left;">
          
            
        <th>S.No.</th>
        <th >Date of Insp.</th>
        <th >Insp. Note No.</th>
        <th >Insp. Title</th>
        <th >Rly./Org.</th>
        <th >Div./Unit</th>
        <!-- <th >Department</th>
        <th >Location</th> -->
        
        <th >View Insp</th>
        <th >Reply</th>
        
        </thead>
        <tbody>

            {% for g in mydata %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{g.inspected_on|date:"d/m/y" }}</td>
                <!-- <td>{{ g.institute_name }}</td> -->
                <!-- <td>{{ g.id }}</td> -->
                <td>{{ g.inspection_note_no }}</td>
                <td><a class="js-btn-tooltip" data-toggle="tooltip" data-placement="top" title='{{g.inspection_title}}'>
                  {{g.inspection_title|slice:":50"}}..
                </a>
              </td>
                
                <td>{% for j in g.location_item %}
                  {% if j.type == 'HQ' %}
                      <span >{{j.item}}<br></span>
                  {% endif %}
                  {% endfor %}
                </td>

                <td>{% for j in g.location_item %}
                        {% if j.type == 'DIV' %}
                            <span >{{j.item}}<br></span>
                        {% endif %}
                        {% endfor %}
                      
                </td>
                    <!-- <td>
                
                      {% for j in g.location_item %}
                      {% if j.type == 'DPT' %}
                          <span >{{j.item}}<br></span>
                      {% endif %}
                      {% endfor %}
                  
                    </td> -->
                    <!-- <td>
                
                      {% for j in g.location_item %}
                      {% if j.type == 'LOC' %}
                          <span >{{j.item}}<br></span>
                      {% endif %}
                      {% endfor %}
                  
                    </td> -->

                

               
                
                
               
                
                <td><a type="button" class="btn " style="background-color: #0000ff; color: #fff;" href="{% url 'inspectionReportPdf' g.inspection_no %}"  style="color: white;" target="blank"><i class="fas fa-eye"></i></a></td>
                <td><a type="button" class="btn " style="background-color: #0000ff; color: #fff;" href="{% url 'corrigendumReportReply' g.inspection_no %}"  style="color: white;" >Reply  </a></td>
                <!-- <td>{{g.status}}</td> -->
               
            </tr> 
            {% endfor %}
        </tbody>

    </table>
</div>
<br>



<!-- Modal for reply-->
<div class="modal fade right" id="ReplyModal" tabindex="-1" role="dialog" aria-labelledby="ReplyModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-full-width" role="document">
  <div class="modal-content modal-content-full-width">
      <div class="modal-header modal-header-full-width">
          <h5 class="modal-title" id="ReplyModalLabel"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
      </div>
      <div class="modal-body">
          <div class="row">
              <div class="col-2">
                  <label >Inspection No</label>
              </div> 
              <div class="col-2" >
                  <input type="text" value=""  id="ins_id" readonly class="form-control" readonly/>
              </div>
              <div class="col-2">
                  <label >Inspection Note No</label>
              </div> 
              <div class="col-2" >
                  <input type="text" value=""  id="ins_note_id" readonly class="form-control" readonly/>
              </div>
          </div>
          <!-- gunjan -->
          <div class="row">
              <div class="col-2">
                  <label>Inspection Officer</label>
              </div>
              <div class="col-2" >
                  <input type="text" value="" id="ins_officer" class="form-control" readonly/>
              </div>
              <div class="col-2">
                  <label >Officer Designation</label>
              </div> 
              <div class="col-2" >
                  <input type="text" value=""  id="ins_desig" readonly class="form-control" readonly/>
              </div>
          </div>

          <div class="row">
              <div class="col-2">
                  <label>Inspection Title</label>
              </div> 
              <div class="col-2" >
                  <input type="text" value="" class="form-control" id="ins_title" readonly/>
              </div>
              <div class="col-2">
                  <label>Inspection Date</label>
              </div>
              <div class="col-2" ><input type="text" value="" id="ins_date" class="form-control" readonly/>
              </div>
          </div>
          <table id="mytable1" class="table table-striped table-bordered table-lg ">
              <thead>
                  <tr>
                      <th>Item No</th>
                      <th>Observation</th>
                      <th>Compliance Status</th>
                      <th>Compliance</th>
                  </tr>
              </thead>
              <tbody>
                  
              </tbody>
          </table>
      </div><!--  Modal Body -->
      <div class="modal-footer modal-footer-full-width">
          <button type="button" class="btn btn-primary" onclick="save_data()">Submit</button> 
          <button type="button" class="btn btn-secondary" data-dismiss="modal" id="closereply">Close</button>
      </div>
  </div><!-- Modal-Content-->
  </div><!-- Modal-Dialog -->
  </div><!-- Modal -->


</body>   
<script>
 
  $("#zone").select2();
 
         // Read selected option
         $('#rly').click(function(){
           var username = $('#rly option:selected').text();
           var userid = $('#rly').val();
       
          
       

         });
 
 $("#division").select2();
 
 $('#division').click(function(){
   var username = $('#div option:selected').text();
   var userid = $('#div').val();
});

 $("#department").select2();
 
 $('#department').click(function(){
   var username = $('#department option:selected').text();
   var userid = $('#department').val();
});


</script>
                                                                                                                                                                                                                                                                                              

<script>
  function filterinspectiondata(){
            var rly=$('#zone').val();
            var dept=$('#department').val();
            var div=$('#division').val();
            var loc=$('#location').val();
                        
            var start_date=$('input#start').val();
            console.log(start_date,"%%%%%%%%%%")
            // alert(start_date);
           
            var end_date=$('input#txtDate2').val();
            console.log(end_date,"%%%%%%%%%%")
           
  }</script>
  
<script>
  $('#zone').change(function() {
var rly=$('#zone').val();

data={
  'rly':rly,
  
}

$.ajax({
type : 'GET',
url : "{% url 'getdiv_rly' %}",
dataType : 'json',
data : data,

success : function(response){
  division=response.division;
              $('#division').empty();
              $('#division').append(`<option value="">All</option>`);
              for (let i = 0; i < division.length; i++) {
              $('#division').append(`<option value="${division[i]}">
                                 ${division[i]}
                            </option>`);
                          }
}
   })
   })




   $("#location").select2({
    minimumInputLength: 1,
    language: {
        inputTooShort: function() {
          return 'Please Add One or More Location';
        }
      },
    tags: [],
    ajax: {
        url: '{% url "autoFetchLocation" %}',
        dataType: 'json',
        type: "GET",
        quietMillis: 50,
        data: function (term) {
            return {
                last_val: term.term
            };
            console.log(term.term)
        },
        processResults: function (data) {
          return {
                results: $.map(data, function (item) {
                  console.log(item)
                    return{
                      text: item.city,
                      
                      id: item.city,
                    }
                })
            };
          },
        
        
    }
});


$(document).ready(function(){

var start = moment().subtract(29, 'days');
var end = moment();

    function cb(start, end) {
        $('#date_range span').html(start.format('DD/MM/YYYY') + ' - ' + end.format('DD/MM/YYYY'));
        
    }

    $('#date_range').daterangepicker({
        startDate: start,
        endDate: end,
        ranges: {
          'Today': [moment(), moment()],
          'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
          'Last 7 Days': [moment().subtract(6, 'days'), moment()],
          'Last 30 Days': [moment().subtract(29, 'days'), moment()],
          'This Month': [moment().startOf('month'), moment().endOf('month')],
          'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        }
    }, cb);

cb(start, end);

});


var table = $('#instituteTable').DataTable({
  "language": {
    "search": "Keyword search:"
  }
});

function getSearchValue(){
  
    console.log($('#date_range span').html())
    
    
        
    let data1 = {
            zone1: JSON.stringify($('#zone').val()),
            division1: JSON.stringify($('#division').val()),
            department1: JSON.stringify($('#department').val()),
            location1: JSON.stringify($('#location').val()),
            date_range: $('#date_range span').html(),
            csrfmiddlewaretoken: '{{ csrf_token }}'
                
        }
    
        $.ajax({
          type : 'POST',
          url : "{% url 'getSearchValueCorrigendum_ajax' %}",
          dataType : 'json',
          data : data1,

          success : function(res){
            console.log(res)
            
            table.destroy()
            $('#instituteTable tbody').empty()
            content = ''
            for(i in res.mydata){
              let index = parseInt(i)+1
              let hq = ''
              let loc = ''
              let dept = ''
              let div = ''
              for(y in res.mydata[i].location_item){
                
                if(res.mydata[i].location_item[y].type == 'HQ'){
                  hq += '<span>' +res.mydata[i].location_item[y].item+'<br></span>'
                }
                else if (res.mydata[i].location_item[y].type == 'LOC'){
                  loc += '<span>' +res.mydata[i].location_item[y].item+'<br></span>'
                }
                else if (res.mydata[i].location_item[y].type == 'DIV'){
                  div += '<span>' +res.mydata[i].location_item[y].item+'<br></span>'
                }
                else if (res.mydata[i].location_item[y].type == 'DPT'){
                  dept += '<span>' +res.mydata[i].location_item[y].item+'<br></span>'
                }
            
                  
              } 


              content += '<tr>'
              content += '<td>'+ index +'</td>'
              content += '<td>'+ formatDate(res.mydata[i].inspected_on) +'</td>'
              content += '<td>'+ res.mydata[i].inspection_note_no +'</td>'
              content += '<td>'+ res.mydata[i].inspection_title.slice(0, 50) +'</td>'
              
                 
              content +='<td>'+hq+'</td>'
              content +='<td>'+div+'</td>'
              // content +='<td>'+dept+'</td>'
              // content +='<td>'+loc+'</td>'

              

              
              
              content += '<td><a type="button" class="btn "  style="background-color: #0000ff; color: #fff;"  href="/inspectionReportPdf/'+res.mydata[i].inspection_no + '"   target="blank"><i class="fas fa-eye"></i></a></td>'
              content += '<td><a type="button" class="btn "  style="background-color: #0000ff; color: #fff;"  href="/reciveCompReportReply/'+res.mydata[i].inspection_no + '"   target="blank">Reply </a></td>'
              
              

              content += '</tr>'
              
            }
            
            $('#instituteTable tbody').append(content)
            table = $('#instituteTable').DataTable({
                          "language": {
                "search": "Keyword search:"
              }
            });
          }
      });
}



function formatDate(date) {
    var d = new Date(date),
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();

    if (month.length < 2) 
        month = '0' + month;
    if (day.length < 2) 
        day = '0' + day;
    let newyear = String(year).slice(2, 5)
    return [day,month,newyear].join('-');
}


$(document).ready(function(){
  
  $('.js-btn-tooltip').tooltip();
 
  $('.js-btn-tooltip--custom-alt').tooltip({
    customClass: 'tooltip-custom-alt'
  });
  
});
</script>

{% endblock %}  