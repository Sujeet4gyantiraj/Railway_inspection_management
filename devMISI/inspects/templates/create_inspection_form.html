{% extends 'base.html' %} 
{% block content %}

{% load static %}

<meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script src="//code.jquery.com/jquery.min.js"></script>
  <!-- <link rel="stylesheet" href="jquery.dropdown.css"> -->
  <script src="jquery.dropdown.js"></script>
  <!-- Include the plugin's CSS and JS: -->
  
  <script type="text/javascript" src="js/bootstrap-multiselect.js"></script>
  <link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css"/>
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  
  <link rel="stylesheet" type="text" href="{% static '/bootstrap-5.1.3-dist/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/bootstrap.min.css' %}">
  
  <link href="{% static '/css/bootstrap-toggle.min.css' %}" rel="stylesheet">
  <script src="{% static '/js/bootstrap-toggle.min.js' %}"></script>
  
      <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" />
      <link rel="stylesheet" type="text/css" media="screen" href="{% static '/css/select2.min.css' %}">
  <link rel="stylesheet" href="{% static '/css/jquery-ui.css' %}">
  
  
  <link rel="stylesheet" href="{% static '/css/font-awesome.min.css' %}">
  
  <script src="{% static 'js/timepicker.js' %}"></script>
  <!-- <link rel="stylesheet" type="text/css" href="{% static '/css/select2.min.css' %}" /> -->
  
    <script src="{% static '/js/jquery.min.js' %}"></script>
     <!-- Select2 CSS --> 
  
  <!-- jQuery --> <script src="{% static '/js/jquery.min4.js' %}"></script> 
  
  <!-- Select2 JS --> 
  <script src="{% static '/js/select2.min.js' %}"></script>
  <!-- Load icon library -->
  <link rel="stylesheet" href="{% static '/css/font-awesome.min.css' %}">
  <!-- multiple selesct marked officer -->
  
  <link href="css/jquery.multiselect.css" rel="stylesheet" type="text/css">
  <script src="{% static '/js/jquery.dataTables.min.js' %}"></script>
    <link href="{% static '/css/jquery.dataTables.min.css' %}"  rel="stylesheet"/>
    <!-- Sheets for datepicker for target date -->
    
    <link rel="stylesheet" href="{% static '/css/jquery-ui.css' %}">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="{% static '/js/jquery-ui.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/quicksand.css' %} ">
    <link rel="stylesheet" type="text/css" href="{% static '/css/lato.css' %} ">
    <link href="{% static 'css/roboto.css' %}" rel="stylesheet"><br>


    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

    <style>
      * {
      box-sizing: border-box;
    }
    /* The Close Button */
    .close {
      color: white;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    
    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }
    * {
      box-sizing: border-box;
    }
    
    /* Style the search field */
    form.example input[type=text] {
      padding: 8px;
      font-size: 17px;
      border: 1px solid grey;
      float: left;
      width: 60%;
      background: #f1f1f1;
    }
    
    /* Style the submit button */
    form.example button {
      float: left;
      width: 15%;
      padding: 8px;
      background: #2196F3;
      color: white;
      font-size: 17px;
      border: 1px solid grey;
      border-left: none; /* Prevent double borders */
      cursor: pointer;
    }
    
    form.example button:hover {
      background: #0b7dda;
    }
    
    /* Clear floats */
    form.example::after {
      content: "";
      clear: both;
      display: table;
    }        
    </style>
    
    <style>
     
     
    
    .autocomplete {
      /*the container must be positioned relative:*/
      position: relative;
      display: inline-block;
    }
    
    .autocomplete-items {
      position: absolute;
      border: 1px solid #d4d4d4;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      /*position the autocomplete items to be the same width as the container:*/
      top: 100%;
      left: 0;
      right: 0;
    }
    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      background-color: #fff;
      border-bottom: 1px solid #d4d4d4;
    }
    .autocomplete-items div:hover {
      /*when hovering an item:*/
      background-color: #e9e9e9;
    }
    .autocomplete-active {
      /*when navigating through the items using the arrow keys:*/
      background-color: DodgerBlue !important;
      color: #ffffff;
    }
    .select2-selection__choice__remove{
      border: none;
    }

    
    
    </style>
    
    <body>
    
      <div class="container">
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == 'success' %}
                  <div class="alert alert-success">
                    <strong>Success </strong>{{ message }}
                  </div>
                {% elif message.tags == 'error' %}
                  <div class="alert alert-danger">
                    <strong>Error </strong>{{ message }}
                  </div>
                {% elif message.tags == 'info' %}
                  <div class="alert alert-info">
                    <strong>Info </strong>{{ message }}
                  </div>
                {% else %}
                
                {% endif %}
               
            
            {% endfor %}
        {% endif %}
      </div>
    
      <h3 style="font-family: 'Lato', sans-serif;">
        <center><b>Create Inspection Notes</b></center>
      </h3>
    
    <div class="container">
      
    
      <br>
      <br>
      <div class="row" >
       
          <div class="col">
              <label for="Zone" >Rly./Org.</label><span style="color:red;font-weight:bold">*</span>
              <select class="form-control" id="zone" name="zone"  style="max-width:100%;" data-placeholder="Select zone.."  multiple required>
                  <option value=""  disabled hidden>select</option>
                  {% for z in Zone %}
                  <option value="{{z}}">{{z}}</option>
                  {% endfor %}
      
              </select>
          </div>
    
        <div class="col">
            <label for="division">Div./Unit</label>
            <select class="form-control" id="division" data-placeholder="Select division.." name="division" style="max-width:100%;"
            multiple>
        
                    <!-- <option value="" selected disabled >NA</option> -->
                    <option value=""  disabled hidden>select</option>
    
                    {% for d in division %}
                    <option value="{{d}}">{{d}}</option>
                    {% endfor %}
        
                </select>
            
        </div>
        <div class="col">
          <label for="division">Department</label>
          <select class="form-control" id="department" data-placeholder="Select department.."  name="department" style="max-width:100%;"
            multiple >
        
                  <option value=""   disabled hidden>select</option>
    
                  {% for d in department %}
                  <option value="{{d.department_name}}">{{d.department_name}}</option>
                  {% endfor %}
        
              </select>
          
        </div>
      
        <div  class="col" >
            <label for="location" >Major Location</label><br>
            <div>
              <select name="location" id="location" class="form-control" data-placeholder="Select location.."  style="max-width:100%;"  multiple>
    
              </select>
            </div>
            
        </div>
          
          <div class="col" >
            <label for="txtDate2" >Insp. Date<span style="color:red;font-weight:bold">*</span></label><br>
            <!-- <input type="text" autocomplete="off"  onchange="setTitle()" name="daterange1" required class="form-control" style="margin-top:0em ;height: 36px; background-color: #fff; max-width: 100%;" id="txtDate2"   readonly requied> -->
            <input type="text" autocomplete="off" placeholder="Select daterange.."  name="daterange1" required class="form-control" style="margin-top:0em; height: 36px; background-color: #fff;border:1px solid rgb(138, 136, 136);box-shadow: none; max-width: 100%;" id="txtDate2"   readonly requied>
            
        </div>
    
      </div> 
    </div>
    
    <br>
    <div class="container">
      
      <label for="start" >Title<span style="color:red;font-weight:bold">*</span></label>
      <textarea class="form-control " maxlength="200" placeholder="Maximum character limit 200"  id="titleinsp"  name="titleinsp" ></textarea>
      <div class="mt-2">
        '<span style="color:red;font-weight:bold">*</span>' : Required Fields in Forms
      </div>
      
    </div> 
    
    
    
    <div class="container">
    
      <form action="{% url 'create_inspection_form' %}" method="POST"> 
        {% csrf_token %}
        <br><br>
         
         
        <br>
        
        <br>
      
      
              
                <table id="table1" class="table table-striped table-bordered center">
      
                  <thead>
                   
                    <tr style="margin-left: 5em;">
                     
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 5px;">Item No.</th>
                      <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 200px;">Title</th> -->
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 500px;"> Inspection Para</th>
                      <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 50px;">Upload Document/Image</th> -->
                      
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 150px;">Action by</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 150px;">Search Officer</th>
                       <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 20px;">Target Date</th>
                      <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 20px;">Priority</th>
                      <!-- <th style= "text-align: left; border-top: 1px solid black; border-bottom: 1px solid black;width: 300px;">Compliance Received On</th> --> 
                    </tr>
                
                  </thead>
                  <tbody  id="addworkmech">
                  
                  </tbody>
                  
              </table>
           
               
            <div>
                  <button  class="btn btn-primary btn-md" onclick="changeColorBtn(this);" id="addheading" style="margin-left: 6em;">Add Heading</button> 
                  <button  type="button" name="addmech"onclick="changeColorBtn(this);" id="addmech" class="btn btn-primary btn-md">Add Sub Heading</button>
                  <button  type="button" name="addSubmech" onclick="changeColorBtn(this);" id="addSubmech" class="btn btn-primary btn-md">Add Description</button>
                  <button  class="btn btn-danger btn-md" id="deletemech" >Delete</button> 
                    
            </div>
      
        
      </form>
          
    </div>
          
          
           
              <div class="container">
                <hr>
                <div class="row">
                  <div class="col-sm-12 col-md-6">
                      
                        <div class="input-group">
                          <span class="input-group-btn">
                                <button class="btn btn-info" type="button" id="copytobtn" value="Copy To" data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setCopyValue()">Copy To</button>
                          </span>
                          <textarea type="text" class="form-control ml-2" id="copyto" placeholder="Add officer" autocomplete="off" readonly></textarea>
                          
                        </div>
                      
                  </div>
                </div>
      
                <div style="text-align: center; margin-top: 2%; margin-bottom: 2%; ">
                  <button type="button" id="draft" name="draft" value="Save as draft" onclick="Savedraft_data(this)" class="btn btn-success btn-md ">Save as Draft</button>  
                  <button type="button" id="submit" name="submit" value="Submit"  class="btn btn-success btn-md" onclick="Action_cc(this);">Submit</button> 
            
                
                </div>
              </div>
           
      
          <br>
          
          
    
    
       
        <div class="modal" tabindex="-1" id="exampleModal" role="dialog" aria-labelledby="exampleModalLabel"
          aria-hidden="true">
          <div class="modal-dialog-modal-xl" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel"><b> Mark Officers</b></h4>
                <button type="button" id="close1" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
             
              <div class="modal-body">
                <form   action="" method="POST" >
                  {% csrf_token %}
                 <input type="text" value="" id="mark_officersss" hidden/>
                
            <div class="row">
                <div class="col-md-3">
                    <label>Railway/Org.</label>
                    <select multiple class="form-control" id="rly_1" name="rly_1" class="custom-select" style="width: 100%;"  multiple >
                        {% for i in Zone %}
                        <option >{{i}}</option>
                        {% endfor %}
            
                    </select>
                </div>
                <div class="col-md-3">
                    <label>Division/Unit</label>
                    <select class="form-control" id="div_1" name="div_1" class="custom-select" style="width: 100%;"  multiple onchange="getdivwisedata()">
                        {% for i in division %}
                        <option>{{i}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label>Department</label>
                    <select multiple class="form-control" id="dept_1" name="dept_1" class="custom-select" style="width: 100%;"  onchange="getdivdeptdata()">
                        {% for i in department %}
                        <option value="{{i.department_name}}">{{i.department_name}}</option>
                        {% endfor %}        
                    </select>
                </div>
                <div class="col-md-3">
                    <label>Designation</label>
                    <select multiple class="form-control" id="desig" name="desig" class="custom-select" style="width: 100%;"  onchange="getdesigdata();">
                        {% for i in alldesig %}
                        <option value="{{i.designation}}">{{i.designation}}</option>
                        {% endfor %}
                    </select>
                </div>
            </div><br>
          <div class="row">
              <div class="col-md-3">
                  <input type="checkbox"  id="allgm" >
                  <label>Select All GM/ZR</label>
              </div>
              <div class="col-md-3">
                  <input type="checkbox"  id="alldrm">
                  <label>Select All DRM</label>
                 
              </div>
              <div class="col-md-3">
                  <input type="checkbox"  id="allphod">
                  <label>Select All PHOD</label>
                 
              </div>
              <div class="col-md-3">
                  <input type="checkbox"  id="allboard">
                  <label>Select All Board Members</label>
                 
              </div>
          </div>
          <br>
          <div class="row">
            <div class="col-md-6">
              <label>Selected Designation</label>
                <!-- <input type="text"  id="alltext" class="form-control" style="background-color: rgb(247, 218, 248);" > -->
                <textarea class="form-control" maxlength="150"   id="alltext"   readonly></textarea>
    
            </div>
            <div class="col-md-1">
              <label></label>
              <button type="button" class="form-control  btn btn-primary" onclick="add_save_marked_officers();">Add</button>
    
            </div>
            <div class="col-md-1">
              <label></label>
              <button type="button" class="form-control btn btn-primary" onclick="remove_save_marked_officers();">Remove</button>
    
            </div>
            <div class="col-md-1">
              <label></label>
              <button type="button" class="btn btn-primary" onclick="save_marked_officers();">Save changes</button>
    
            </div>
            <div class="col-md-3">
              
            </div>
            </div>
            <br>
            <div class="row" id="showdiv1">
              <div class="col-md-6">
                    <table id="text" class="table table-striped table-bordered ">
                      <thead>
                        <tr><th></th>
                          <th></th></tr>
                      </thead>
                      <tbody>
                      </tbody>  
                  </table>
              </div>
              <div class="col-md-6">
                    <table id="text1" class="table table-striped table-bordered ">
                      <thead>
                          <tr><th></th><th></th></tr>
                      </thead>
                      <tbody>
                        
                      </tbody>
                  </table>
              </div>
            </div>
            <div class="row" id="showdiv2">
              <div class="col-md-6">
                    <table id="textdesig" class="table table-striped table-bordered ">
                      <thead>
                        <tr>
                          <th></th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>  
                    </table>
              </div>
              <div class="col-md-1"></div>
              <div class="col-md-5" hidden>
                <table id="textdesigselect" class="table table-striped table-bordered ">
                  <thead>
                    <tr>
                      <th hidden></th>
                      <th>Selected Employee/Designation</th>
                    </tr>
                  </thead>
                  <tbody>
                  </tbody>  
                </table>
              </div>
            </div>
            <br>
    
            <input type="hidden" value="0" id="s1" name="s1">
            </form>
            </div>
              <div class="modal-footer">
                
                
              </div>
            </div>
          </div>
      
        </div>
        
       
                
        
        <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b> Target Date</b></h4>
              
            </div>
           
              <div class="modal-body">
                
                  
            
           
              
              <div><label for="start" >Target Date</label><br><input type="date"  class="col-md-2" required class="form-control" style="height: 2em;margin-top:0.7em;" id="target_date" value="new Date()"  onkeydown='event.preventDefault()' requied>
               
               
               </div>
    
            </div>
           
                
              </body>
              </div>
             
              </div>
    
          </div>
        </div>
      </div>
    
    <script>
    
    $("#location").select2({
        minimumInputLength: 1,
        language: {
            inputTooShort: function() {
              return 'Please Add One or More Location';
            }
          },
        tags: [],
        ajax: {
            url: '{% url "autoFetchLocation" %}',
            dataType: 'json',
            type: "GET",
            quietMillis: 50,
            data: function (term) {
                return {
                    last_val: term.term
                };
                console.log(term.term)
            },
            processResults: function (data) {
              return {
                    results: $.map(data, function (item) {
                      console.log(item)
                        return{
                          text: item.city,
                          
                          id: item.city,
                        }
                    })
                };
              },
            
            
        }
    });
    </script>
    
    
    <script>
    
    var globallistgm='';
    var globallistbm='';
    var globallistdrm='';
    var globallistphod='';
    
    function auto(inp, arr) {
      var currentFocus;
      inp.addEventListener("input", function(e) {
          var a, b, i, val = this.value;
          closeAllLists();
          if (!val) { return false;}
          currentFocus = -1;
          a = document.createElement("DIV");
          a.setAttribute("id", this.id + "autocomplete-list");
          a.setAttribute("class", "autocomplete-items");
        
          this.parentNode.appendChild(a);
       
          for (i = 0; i < arr.length; i++) {
    
            if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
              
              b = document.createElement("DIV");
           
              b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
              b.innerHTML += arr[i].substr(val.length);
            
              b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
           
                  b.addEventListener("click", function(e) {
            
                  inp.value = this.getElementsByTagName("input")[0].value;
                  
                  closeAllLists();
                  
              });
              a.appendChild(b);
            }
          }
      });
    
      inp.addEventListener("keydown", function(e) {
          var x = document.getElementById(this.id + "autocomplete-list");
          if (x) x = x.getElementsByTagName("div");
          if (e.keyCode == 40) {
            
            currentFocus++;
            
            addActive(x);
          } else if (e.keyCode == 38) { 
          
            currentFocus--;
           
            addActive(x);
          } else if (e.keyCode == 13) {
         
            e.preventDefault();
            if (currentFocus > -1) {
            
              if (x) x[currentFocus].click();
            }
          }
      });
      function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
      
        x[currentFocus].classList.add("autocomplete-active");
      }
      function removeActive(x) {
       
        for (var i = 0; i < x.length; i++) {
          x[i].classList.remove("autocomplete-active");
        }
      }
      function closeAllLists(elmnt) {
       
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
          if (elmnt != x[i] && elmnt != inp) {
          x[i].parentNode.removeChild(x[i]);
        }
      }
    }
    
    document.addEventListener("click", function (e) {
        closeAllLists(e.target);
    });
    }
    
    
    </script>
          
    <script>
      var hli = 0
      var sli = []
      
      var ssli = []
      
    
      var full_array = []
    $(document).ready(function(){
                  // let rly ="{{ ins_detail.zone }}";
                  // console.log(rly);
                  // $('select[name="zone"] option:selected').attr("selected", null);
                  // $("#zone option[value="+rly+"]").attr("selected", "selected");
                  
                    $("#addmech").click(function (e) {
    
                      if (sli.length == 0){
                        alert('Please Add heading First')
                        return false;
                      }
                    
                      var table = document.getElementById("addworkmech");
                      e.preventDefault();
                    //  var heading= table.insertRow();
                    //  h1=headingCount;
                      var row = table.insertRow();
    
                    
                      //var rowCount = $('#addworkmech tr').length;
                      
                      //j1=rowCount;
                      //i1=rowCount;
                      
                      
                      sli[hli-1] = sli[hli-1]+1
                      //let rowlen = parseInt(rowCount)-1
                      console.log(sli)
                      
                      //let item = hli+'.' + String(rowlen)
                      let item = hli+'.' + String(sli[hli-1])
                      ssli.push(0)
    
                      ///added/////////////////////////////////////
                      let officerid='divofficer'+hli;
                      let markeofficerid='divmarkeofficer'+hli;
                      let targetdateid='divtargetdate'+hli;
                      let div_checkbox='divcheckbox'+hli
                      

                      $('#'+officerid).hide();
                     $('#'+markeofficerid).hide();
                      $('#'+targetdateid).hide();
                      $('#'+div_checkbox).hide();
                      ///////////////////////////////////////
    
                    //  j1 = j1 + 1;
                    //  var work1 = 'work1' + String(j1);
                    // var heading_title=heading.insertCell(0);
            
                    //  var cell1 = row.insertCell(0);
                      var cell2 = row.insertCell(0);
                      var cell3 = row.insertCell(1);
                      var cell4 = row.insertCell(2);
                      var cell5 = row.insertCell(3);
                      var cell6 = row.insertCell(4);
                      var cell7 = row.insertCell(5);
    
                    // cell1.innerHTML =
                    // '<td style="width:5px;""><div style="text-align: center; width:5px font-family:verdana;">'+(j1)+'</div></td>';
                    
                    full_array.push(item)
                    
                    var itemno='itemno'+item
                    var observation='observation'+item
                    var officer='officer'+item
                    var markeofficer='markeofficer'+item
                    var targetdate='targetdate'+item
                    var divcheckbox='divcheckbox'+item
                    var checkbox='check'+item
                    
                  
                    cell2.innerHTML = '<td><div class="autocomplete1"><div style="text-align: center; width:5px font-family:verdana;" id='+itemno+'>'+item+'</div></td>';
                
  
                    cell3.innerHTML ='<td><div class="autocomplete1"><textarea maxlength="500" id='+observation+' autocomplete1 = "off"  style="height:50px;" class="form-control" /></textarea></div></td>'; 
                    
                    cell4.innerHTML ='<td><textarea type="text" class="form-control" value="" custom-offic="" custom-key="" id='+markeofficer+' class="autocomplete1" readonly></textarea></td>'
                    cell5.innerHTML = '<td><div class="autocomplete1"><button type="button" class="btn btn-primary btn-md" id='+officer+'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" style="margin-left:1vh;margin-top:1vh;"><i class="fas fa-info"></i></button>  </div></td>'; 
                    
                    cell6.innerHTML ='<td><div class="autocomplete1"><input type="text" autocomplete="off" class="form-control datepker" placeholder="dd/mm/yy" style="height: 2em; width: 118px;" id='+targetdate+'  readonly > </div></td>'; 
                    
                    cell7.innerHTML ='<td><div class="autocomplete1" id="'+divcheckbox+'"><input type="checkbox" value="1" autocomplete="off" style="height: 2em; width: 118px;" id='+checkbox+' > </div></td>'; 
                    
                    // cell3.innerHTML =
                    // '<td><div class="autocomplete1"><label for="myfile">Upload a file:</label><input type="file" id="myfile" name="myfile"></div></td>'; 
                    // <div class="col-sm-6"><select name="officer_code1" id="officers_code1" class="custom-select" multiple="multiple" style="width:200%;height:20%;"> {% for t in hqwise %}<option value="{{t.empname}}">{{t.empname}}</option>{% endfor %}</select><input type="text" id="officer_code_hidden" name="officer_code_hidden" hidden></div> 
                    $("textarea").each(function () {
                      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                        }).on("input", function () {
                          this.style.height = "auto";
                          this.style.height = (this.scrollHeight) + "px";
                        });
    
                  //var min = new Date();
    
                  $('.datepker').datepicker({
                    dateFormat: 'dd/mm/yy',
                    minDate: 0
                    
                  })
    
                  //$('.datepker').datepicker('setDate',min);
                  
                  
                  });
    
                    
                
              
              $("#addheading").click(function (e) {
                
                var table = document.getElementById("addworkmech");
                      e.preventDefault();
                    
                      var row1 = table.insertRow();
                      var row1Count = 1;
                      hli++;
                      sli.push(0)
                      
                      var cell1 = row1.insertCell(0);
                      var cell2 = row1.insertCell(1);
                    //  var cell3 = row.insertCell(2);
                      
                    
    
                      full_array.push(String(hli))
                      
                      var heading1='heading'+hli
    
    
                      cell1.innerHTML='<div style="text-align: center; width:5px font-family:verdana;">'+ hli+'</div>'
                      cell2.innerHTML ='<td><div class="autocomplete1"><textarea maxlength="100" id='+heading1+'  autocomplete1=off  style="height:30px;" class="form-control" /></textarea></div></td>'; 
    
                      ///added//////////////////////////////////
    
                      var cell3 = row1.insertCell(2);
                      var cell4 = row1.insertCell(3);
                      var cell5 = row1.insertCell(4);
                      var cell6 = row1.insertCell(5);
    
                      var officer='officer'+hli
                      var markeofficer='markeofficer'+hli
                      var targetdate='targetdate'+hli
                      var divofficer='divofficer'+hli
                      var divmarkeofficer='divmarkeofficer'+hli
                      var divtargetdate='divtargetdate'+hli
                      var divcheckbox='divcheckbox'+hli
                      var checkbox='check'+hli
                    
           
                    
                    cell3.innerHTML ='<td ><div class="autocomplete1" id="'+divmarkeofficer+'"><textarea type="text" class="form-control" value="" custom-offic="" custom-key="" id='+markeofficer+' class="autocomplete1" readonly></textarea></div></td>'
                    cell4.innerHTML ='<td ><div class="autocomplete1" id="'+divofficer+'"><button type="button" class="btn btn-primary btn-md" id='+officer+'  data-toggle="modal" data-target="#exampleModal" onclick="hidetable(this); setvalueIN()" style="margin-left:1vh;margin-top:1vh;"><i class="fas fa-info"></i></button>  </div></td>'; 
                    cell5.innerHTML ='<td><div class="autocomplete1" id="'+divtargetdate+'"><input type="text"  class="form-control datepker" autocomplete="off" placeholder="dd/mm/yy" style="height: 2em; width: 118px;" id='+targetdate+' readonly> </div></td>'; 
                    
                    cell6.innerHTML ='<td><div class="autocomplete1" id="'+divcheckbox+'"><input type="checkbox" value="1" autocomplete="off" style="height: 2em; width: 118px;" id='+checkbox+' > </div></td>'; 
                   
                    $('.datepker').datepicker({
                      dateFormat: 'dd/mm/yy',
                      minDate: 0
                      
                    })
                    //var min = new Date();
                    //$('.datepker').datepicker('setDate',min);
    
                      $("textarea").each(function () {
                      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                        }).on("input", function () {
                          this.style.height = "auto";
                          this.style.height = (this.scrollHeight) + "px";
                        });
    
                      ///////////////////////////////////////
                      
              });
    
              $("#addSubmech").click(function (e) {
                
                var table = document.getElementById("addworkmech");
                      e.preventDefault();
                      let item = hli+'.' + String(sli[hli-1])
                      
                      if(hli == 0){
                        alert('Add Desc First')
                        return false;
                      }
                      if(sli[hli-1] == 0)
                      {
                        alert('Add Sub Heading');
                        return false;
                      }
                      var row1 = table.insertRow();
                      var row1Count = 1;
                      
                      
                      ssli[ssli.length-1] = ssli[ssli.length-1]+1
                      
                      let item2 = item+'.'+String(ssli[ssli.length-1])
                      console.log(ssli)
                      var cell1 = row1.insertCell(0);
                      var cell2 = row1.insertCell(1);
                    //  var cell3 = row.insertCell(2);
                      full_array.push(item2)
    
                      var subheading1='subdes'+item2
    
                      cell1.innerHTML='<div style="text-align: center;  height:50px; width:5px; font-family:verdana;"></div>'
                      cell2.innerHTML ='<td>'+ item2 +'<div class="autocomplete1"><textarea maxlength="250" id='+subheading1+' autocomplete1 = "off"  style="height:30px;margin-left: 100px; width: 82%;" class="form-control" /></textarea></div></td>'; 
    
                      $("textarea").each(function () {
                      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                        }).on("input", function () {
                          this.style.height = "auto";
                          this.style.height = (this.scrollHeight) + "px";
                        });
              });
    
    
    
    
          $('#deletemech').click(function (e) {
                e.preventDefault();
                  var rowCount = $('#addworkmech tr').length;
    
                  ///added////////////////
                  var table = document.getElementById("addworkmech"); 
                  let val_id=table.rows[rowCount-1].cells[0].innerText;
                 
                  if(val_id !='')
                  {     
                    let val_split=val_id.split('.');
                    
                    if(val_split.length > 1)
                    {
                      let del_id=val_split[0]+'.'+'1';
                      if(del_id == val_id)
                      {
                        
                        let officerid='divofficer'+val_split[0];
                        let markeofficerid='divmarkeofficer'+val_split[0];
                        let targetdateid='divtargetdate'+val_split[0];
                        $('#'+officerid).show();
                        $('#'+markeofficerid).show();
                        $('#'+targetdateid).show();
                        $("textarea").each(function () {
                          this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
                            }).on("input", function () {
                              this.style.height = "auto";
                              this.style.height = (this.scrollHeight) + "px";
                        });
                      }
    
                    }
                        
                  }
                  ///////////////////////////////////////
    
                  j1=rowCount;                    
                  if (j1 > 0) {
                  //console.log(sli)
                  full_array.pop()
                  document.getElementById("addworkmech").deleteRow(-1);
                  if( hli > 0 && sli[hli-1] !=0 )
                  {
                   
                      if(ssli[ssli.length-1]==0)
                      {
                        ssli.pop()
                        if(sli[hli-1]==0){
                          sli.pop()
                          hli--;
                        }else{
                          sli[hli-1] = sli[hli-1]-1
                        }
                      }
                      else
                      {
                        ssli[ssli.length-1]=ssli[ssli.length-1]-1
                      }
                }
                else if( hli > 0 && sli[hli-1] == 0 )
                  {
                        if(sli[hli-1]==0)
                        {
                          sli.pop()
                          hli--;
                        }
                        else
                        {
                          sli[hli-1] = sli[hli-1]-1
                        }
                }
                  j1--;
                  
    
                }
                
    
          });
    
    
    });
    
    //================================================================================================           
    //================================================================================================           
    //================================================================================================         
    </script>
    
    <script>
        
    
        function Savedraft_data()
          { 
            var zone=$("#zone").val();
            var division=$("#division").val();
            
            var department=$('#department').val();
            var inspection_date=$('#txtDate2').val();
            
    
            if(full_array.length == 0){
              alert('Please Enter Inspection Details')
              return false;
            }
    
            let ar1 = {}
            let myarr2 = {}
            for(let i=1; i<=hli; i++){
              let ar ={}
              let myar1 = []
              for(let j=0; j<full_array.length; j++){
                if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.'){
                //if((String(i)+'.')==String(full_array[j]).substr(0,1)){
                  let temp = full_array[j].split('.')
                  myar1.push(String(full_array[j]))
                  
                  if(temp.length == 1){
                    let hid='heading'+ full_array[j];
                    var val = document.getElementById(hid).value;
                    ar[hid]=val
    
                    if(val == ''){
                      alert('Please fill Heading')
                      document.getElementById(hid).focus()
                      
                      return false;
                    }
                    if(full_array.includes(String(full_array[j]+'.1')))
                    {
                        a=1;
                               
                    }
                    else{
                        
                        let td = 'targetdate' + full_array[j];
                        let mf = 'markeofficer' + full_array[j];
                        let chk = 'check'+ full_array[j];
                    
                        var tddate = document.getElementById(td).value;
                        let chk_val = document.getElementById(chk)
                          // alert(chk_val)
                          if (chk_val.checked == true){
                              var checkbox = '1'
                              //alert(checkbox)
                          }
                          else if (chk_val.checked == false){

                            checkbox = '0'
                            //alert(checkbox)
                          }
                        
                        var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                        
                    
                        ar[td]=tddate
                        ar[mf]=officer_val
                        ar[chk]=checkbox     
                    }
    
                    
                    
              
                  }
                  else if(temp.length == 2){
                    let sid='observation'+full_array[j];
                    let td = 'targetdate' + full_array[j];
                    let mf = 'markeofficer' + full_array[j];
                    
                    let chk = 'check'+ full_array[j];
    
                    var val1 = document.getElementById(sid).value;
                    var tddate = document.getElementById(td).value;
                    
                    
                    // if(tddate == '' || tddate == null){
                    //   alert('Please Add Target Date')
                    //   return false;
                    // }
                    let chk_val = document.getElementById(chk)
                          // alert(chk_val)
                          if (chk_val.checked == true){
                              var checkbox = '1'
                              //alert(checkbox)
                          }
                          else if (chk_val.checked == false){

                            checkbox = '0'
                            //alert(checkbox)
                          }
                    var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                
                    ar[sid]=val1
                    ar[td]=tddate
                    ar[mf]=officer_val
                    ar[chk]=checkbox    
    
                    if(val1 == ''){
                      alert('Please fill Observation')
                      document.getElementById(sid).focus();
                      return false;
                    }
                  }
                  else{
                    let ssid='subdes'+full_array[j];
                    var val2 = document.getElementById(ssid).value;
                    ar[ssid]=val2
    
                    
                  }
                  
                }
              }
              
              ar1[String(i)]=ar
              myarr2[String(i)]=myar1
            }
            console.log(ar1)
            console.log(myarr2)
          
        var final_p=JSON.stringify(ar1)
        var id_final = JSON.stringify(myarr2)
        
        if(zone =='' || zone == null){
          alert("Please fill Rly/Org ")
          return false;
        }
        
        
        
        if(inspection_date=='' || inspection_date==undefined){
            alert("Please fill date of inspection ")
            return false;
        }
        if($('#titleinsp').val()==''){
          alert("Please fill title of inspection ")
          return false;
        }
        
        $("#draft").attr("disabled", true);
        let data1 = {
            zone: JSON.stringify($('#zone').val()),
            division: JSON.stringify($('#division').val()),
            department: JSON.stringify($('#department').val()),
            location: JSON.stringify($('#location').val()),
            
    
            txtDate2:$('#txtDate2').val(),
            titleinsp: $('#titleinsp').val(),
            send_to: document.getElementById('copyto').getAttribute('custom-offic'),
            send_desig: document.getElementById('copyto').value,
    
            final_partinspected:final_p,
            id_partinspected:id_final,
            csrfmiddlewaretoken: '{{ csrf_token }}'
          };
        
                $.ajax({
                          type: 'POST',
                            url: "{% url 'save_draft_data' %}",
                            dataType: 'json',
                            data: data1,
                            success: function (response) {
                              $("#draft").attr("disabled", false);
                              //alert("Record Saved as Draft.");
                              window.location.href='{% url "draft_inspection_form" %}';
           
                        },
                        error: function (exception) {
                    
                          alert("oops error!");
                      window.location.reload();
                }
              
          });
             
    }
    
    
    
    ////////////////////////////////   added 03/08/22
    
    var globalarrid=[], main=[];
    function remove_save_marked_officers()
    {
      if(globalarrid.length==0)
      {
        alert('Nothing to Remove');
        return false;
      }
      globalarrid.pop();
      main.pop();
    
      document.getElementById('alltext').value=globalarrid;
        
    }
    function add_save_marked_officers(){
      var emp_no = ""
      var emp_no1 = ""
      var table = $('#text').DataTable();
      table.destroy();
      table = $('#text1').DataTable();
      table.destroy();
      var table = $('#text').DataTable();
      table.destroy();
      table = $('#textdesigselect').DataTable();
      table.destroy();
    
      
      let lst1='no';
      let lst2='no';
      $("input[type='checkbox'][name='chktext']:not(:checked)").each(function (){
        lst1='yes';
      });
      $("input[type='checkbox'][name='chktext1']:not(:checked)").each(function (){
        lst2='yes';
      });
      var rly_1=$('#rly_1').val();
      var div_1=$('#div_1').val();
      if(globallistgm!='' && lst1 == 'yes')
      { 
        globallistgm='';
      }
      if(globallistbm!='' && lst1 == 'yes')
      { 
        globallistbm='';
      }
      if(globallistphod!='' && lst1 == 'no')
      { 
          let x='';
          if(rly_1 == '')
            globallistphod=globallistphod;
            else{
          for(ii=0;ii<rly_1.length;ii++)
          {
            x=x+globallistphod+'/'+rly_1[ii]+', ';
          }
          globallistphod=x;}
      }
      else if(globallistphod!='' && lst1 == 'yes')
      { 
        globallistphod='';
      }
      if(globallistdrm!='' && lst2 == 'no')
      { let x='';
          if(rly_1 == '')
            globallistdrm=globallistdrm;
          else{
            for(ii=0;ii<rly_1.length;ii++)
            {
              x=x+globallistdrm+'/'+rly_1[ii]+', ';
            }
    
            globallistdrm=x;}
      }
      else if(globallistdrm!='' && lst2 == 'yes')
      { 
        globallistdrm='';
      }
      let chkdes=0,arrdemp=[],arrsemp=[];
      let g=0,d=0,p=0,b=0,chgdesig ='Y';
      
      $('.messageCheckbox:checkbox:checked').each(function(i){
        //val[i] = $(this).val();
        let oneOffic= $(this).val();
        let id = oneOffic.split(',')[0]
        let desig = oneOffic.split(',')[1]
        
        
        chkdes=0;
        if(desig.startsWith("DRM/") && chgdesig == 'Y')
        {
          chgdesig = 'N';
          if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }
        }
        if(globallistgm!='' )
        {
              $("input[type='checkbox'][name='chktext']:checked").each(function (){
                    if(desig == $(this).val().split(',')[1])
                    chkdes=1;
              });
              if(g==0)
              { 
                g=1;
                if(emp_no1!="")
                  emp_no1+=',';
              emp_no1 +=globallistgm;
    
              if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }
                      
            }
        }
        else if(globallistbm!=''  )
        {
                $("input[type='checkbox'][name='chktext']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                      chkdes=1;
                });
                if(g==0){ g=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistbm;
                if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
        else if(globallistphod!='' )
        {
          $("input[type='checkbox'][name='chktext']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                      chkdes=1;
                });
                if(p==0){ p=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistphod;
                if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
     
        if(globallistdrm!=''  && desig.startsWith("DRM/"))
        {
          $("input[type='checkbox'][name='chktext1']:checked").each(function (){
                     if(desig == $(this).val().split(',')[1])
                        chkdes=1;
                });
                if(d==0){ d=1;
                  if(emp_no1!="")
                    emp_no1+=',';
                emp_no1 +=globallistdrm;
               
                    if(arrsemp.length != 0)
                      {
                        arrdemp.push(arrsemp);
                        arrsemp=[]
                      }}
        }
        if(chkdes == 0)
        {
          if(arrsemp.length != 0)
          {
            arrdemp.push(arrsemp);
          }
          arrsemp=[]
          if(emp_no1!="")
                    emp_no1+=',';
          emp_no1 +=desig;
         
          if(emp_no!="")
              emp_no+=',';
          emp_no +=id;
          arrsemp.push(id);
          
        }
        else
        {
          if(emp_no!="")
              emp_no+=',';
          emp_no +=id;
          arrsemp.push(id);
          
        }
        
      });
      arrdemp.push(arrsemp);
      if(emp_no == '')
      {
        alert('Select Checkbox To add');
        $('#text').DataTable();
        $('#text1').DataTable();
        $('#textdesigselect').DataTable();
        return false;
      }
      
        let chkemp_no1=emp_no1.split(',');
        let chkemp_no=emp_no.split(',');
    
        if(document.getElementById('alltext').value!='')
            globalarrid=(document.getElementById('alltext').value).split(',');
        // for(let ij=0;ij<chkemp_no1.length;ij++)
        // {
        //     if(globalarrid.includes(String(chkemp_no1[ij])))
        //     {
        //       alert(chkemp_no1[ij]+' is already previously added ..');
        //     }
        //     else
        //     {
        //       main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
        //       globalarrid.push(chkemp_no1[ij]);
        //     }
        // }
        // document.getElementById('alltext').value=globalarrid;
        

        
    //////////////////  changed
    let prevpost='',prevchk=0;

for(let ij=0;ij<chkemp_no1.length;ij++)
{
  //alert(chkemp_no1[ij]);
    if(globalarrid.includes(String(chkemp_no1[ij])))
    {
      if (prevpost!='')
        prevpost=prevpost+', ';
      prevpost=prevpost+chkemp_no1[ij];
      prevchk=1;
      //alert(chkemp_no1[ij]+' is already previously added ..');
    }
    
    else if(chkemp_no1[ij] == "All GM's/ZR")
    {
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm].substring(0,3)=='GM/')
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }

      }
      main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);

    }
    else if(chkemp_no1[ij].substring(0,3)=='GM/')
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All GM's/ZR")
        {
          chkcgm=1
        }

      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
          prevpost=prevpost+', ';
        prevpost=prevpost+chkemp_no1[ij];
        prevchk=1;
      }

    }

    else if(chkemp_no1[ij] == "All DRM's")
    {
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm].substring(0,4)=='DRM/')
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }
        else if(globalarrid[cgm].substring(0,10)=="All DRM's/")
        {
          globalarrid.splice(cgm,1);
          main.splice(cgm,1);
        }

      }
      main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);

    }

    else if(chkemp_no1[ij].substring(0,4)=='DRM/')
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All DRM's")
        {
          chkcgm=1
        }
        else if(globalarrid[cgm].substring(0,10)=="All DRM's/")
        {
          for(drmi=0;drmi<main[cgm]['empno'].length;drmi++)
          {
            if(chkemp_no.includes(main[cgm]['empno'][drmi]))
            {
              chkcgm=1;
              break;
            }

          }
        }
      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
            prevpost=prevpost+', ';
          prevpost=prevpost+chkemp_no1[ij];
          prevchk=1;
      }
    }
    
    else if(chkemp_no1[ij].substring(0,10)=="All DRM's/")
    {
      let chkcgm=0
      for(let cgm=globalarrid.length-1;cgm>=0;cgm--)
      {
        if(globalarrid[cgm]=="All DRM's")
        {
          chkcgm=1
        }
      }
      if(chkcgm==0)
      {
      main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
      }
      else
      {
        if (prevpost!='')
            prevpost=prevpost+', ';
          prevpost=prevpost+chkemp_no1[ij];
          prevchk=1;
      }
    }
    else
    {
      main.push({'desig':chkemp_no1[ij],'empno':arrdemp[ij]});
      globalarrid.push(chkemp_no1[ij]);
    }
}



if(prevchk==1)
{
  alert('Following Post Are already Present '+prevpost);
}
for(let remi=globalarrid.length-1;remi>=0;remi--)
{
  if(globalarrid[remi].length==0 || globalarrid[remi]==' ')
        {
          globalarrid.splice(remi,1);
          main.splice(remi,1);
        }

}
//////////////////  changed
document.getElementById('alltext').value=globalarrid;


        
    
      ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            } 
    
      ele=document.getElementsByName('chk');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }
    
      ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            } 
  //////////////////  changed
            ele=document.getElementsByName('chkdesig');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
        }
//////////////////  changed


      globallistdrm='';
      globallistgm='';
      globallistphod='';
      globallistbm='';
      document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
    
      document.getElementById('rly_1').value='';
      document.getElementById('div_1').value='';
      document.getElementById('dept_1').value='';
      document.getElementById('desig').value='';
        $('#text').DataTable();
        $('#text1').DataTable();
        $('#textdesigselect').DataTable();
      
    }
    
    
    /////////////////////////////    end 03/08/22   
    function save_marked_officers(){
     let emp_no='',emp_no1='';
      for(i=0;i<main.length;i++)
      {
        if(emp_no1!="")
            emp_no1+=',';
          emp_no1+=main[i].desig;
        x=main[i].empno;
        if(emp_no!="")
            emp_no+=',';
          emp_no+=main[i].empno;
      }
     
      let mark_off = $('#mark_officersss').val();
    
      if(mark_off=='Copy To'){
                                  
        document.getElementById('copyto').value=emp_no1;
        var myInput = document.getElementById('copyto');
            myInput.setAttribute('custom-offic', emp_no);
        let Y = document.getElementById('copyto').scrollHeight
        document.getElementById('copyto').style.height =(10+Y)+"px";
    
    
        var myInput = document.getElementById('copyto');
            myInput.setAttribute('custom-key', main);
    
      }else{
        markofficer='markeofficer'+ mark_off
        document.getElementById(markofficer).value=emp_no1;
        var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-offic', emp_no);
    
            let x = document.getElementById(markofficer).scrollHeight
            document.getElementById(markofficer).style.height =(10+x)+"px";
    
    
            var myInput = document.getElementById(markofficer);
            myInput.setAttribute('custom-key', JSON.stringify(main));
            
      }
      $('#close1').click();
      
    
    }
          
    </script>
    
    <script>
        
    function Action_cc() { 
    
            var zone=$("#zone").val();
            
            var division=$("#division").val();
            var location=$("#location").val();
            var department=$('#department').val();
            var inspection_date=$('#txtDate2').val();
            //alert(inspection_date)
            
    
            let ar1 = {}
            let myarr2 = {}
    
            
            if(full_array.length == 0){
              alert('Please Enter Inspection Details')
              return false;
            }
            for(let i=1; i<=hli; i++){
              let ar ={}
              let myar1 = []
              for(let j=0; j<full_array.length; j++){
                //if(String(i)==String(full_array[j]).substr(0,1)){
                if((String(i)+'.')==((String(full_array[j]).split('.'))[0])+'.'){
                  let temp = full_array[j].split('.')
                  myar1.push(String(full_array[j]))
                  
                  if(temp.length == 1){
                    let hid='heading'+ full_array[j];
                    var val = document.getElementById(hid).value;
                    ar[hid]=val
    
                    if(val == ''){
                      alert('Please fill sone data in Observation')
                      return false;
                    }
                    
                    if(full_array.includes(String(full_array[j]+'.1')))
                    {
                                a=1;
                               
                    }
                    else{
                        
                        let td = 'targetdate' + full_array[j];
                        let mf = 'markeofficer' + full_array[j];
                        let chk = 'check'+ full_array[j]
    
                    
                        var tddate = document.getElementById(td).value;
                        var chkvalue = document.getElementById(chk).value;
    
                        // if(tddate == '' || tddate == null){
                        //   alert('Please Add Target Date')
                        //   return false;
                        // }
                        var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                        
                    
                        ar[td]=tddate
                        ar[mf]=officer_val
                        ar[chk]=chkvalue
                                
                    }
                    
                  }
                  else if(temp.length == 2){
                    let sid='observation'+full_array[j];
                    let td = 'targetdate' + full_array[j];
                    let mf = 'markeofficer' + full_array[j];
                    let chk = 'check'+ full_array[j]
    
                    var val1 = document.getElementById(sid).value;
                    var tddate = document.getElementById(td).value;
                    var chkvalue = document.getElementById(chk).value;
                    // if(tddate == '' || tddate == null){
                    //   alert('Please Add Target Date')
                    //   return false;
                    // }
    
                    var officer_val = document.getElementById(mf).getAttribute('custom-offic');
                    
                    ar[sid]=val1
                    ar[td]=tddate
                    ar[mf]=officer_val
                    ar[chk]=chkvalue
                  } 
                  else{
                    let ssid='subdes'+full_array[j];
                    var val2 = document.getElementById(ssid).value;
                    if(val2 == ''){
                      alert('Please add description')
                      return false;
                    }
                    ar[ssid]=val2
                  }
                  
                }
              }
              
              ar1[String(i)]=ar
              myarr2[String(i)]=myar1
            }
            console.log(ar1)
            console.log(myarr2)
            
    
        var final_p=JSON.stringify(ar1)
        var id_final = JSON.stringify(myarr2)
            
        if(zone =='' || zone==null){
          alert("Please fill Rly/Org ")
          return false;
        }
        
        if(inspection_date=='' || inspection_date==undefined){
            alert("Please fill date of inspection ")
            return false;
        }
        if($('#titleinsp').val()==''){
          alert("Please fill title of inspection ")
          return false;
        }
        
          
        for(x in full_array){
          let spid = full_array[x].split('.')
          
          if(spid.length == 2){
            let offid = 'markeofficer'+full_array[x]
            let offVal = document.getElementById(offid).value
            
            if(offVal == ''){
              alert('Please Add mark officers')
              return false;
            }
          }
        }
       
        
        $("#submit").attr("disabled", true);
        let data1 = {
            zone: JSON.stringify($('#zone').val()),
            division: JSON.stringify($('#division').val()),
            department: JSON.stringify($('#department').val()),
            location: JSON.stringify($('#location').val()),
            
            
            txtDate2: $('#txtDate2').val(),
            titleinsp: $('#titleinsp').val(),
    
            final_partinspected:final_p,
            id_partinspected:id_final,
            send_to: document.getElementById('copyto').getAttribute('custom-offic'),
            send_desig: document.getElementById('copyto').value,
            csrfmiddlewaretoken: '{{ csrf_token }}'
          
          };
        
          $.ajax({
                  type: 'POST',
                  url: "{% url 'create_inspection_details' %}",
                  dataType: 'json',
                  data: data1,
                  success: function (response) {
    
                    //alert("Record Saved");
                    $("#submit").attr("disabled", false);
                    window.location.href='{% url "inspection_doneby_list" %}'
                    
                  },
                  error: function (exception) {
                    
                    alert("oops error!");
                  window.location.reload();
              }
              
          });
          
    
    }
    </script>
    <script>
    
    
    
    
        function select1(id){  
          var table = $('#text1').DataTable();
          table.destroy();
          if(id.checked)
          {
            var ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=true;  
            }  
            var table = $('#text1').DataTable();
          }
          else
          {
            var ele=document.getElementsByName('chktext1');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            var table = $('#text1').DataTable();
          }
        }  
        function select21(id){  
          var table = $('#text').DataTable();
          table.destroy();
          if(id.checked)
          {
            var ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=true;  
            }  
            var table = $('#text').DataTable();
          }
          else
          {
            var ele=document.getElementsByName('chktext');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            var table = $('#text').DataTable();
          }
        }  
        // function deSelect(){ 
        //   var table = $('#text').DataTable();
        //   table.destroy(); 
        //     var ele=document.getElementsByName('chk');  
        //     for(var i=0; i<ele.length; i++){  
        //         if(ele[i].type=='checkbox')  
        //             ele[i].checked=false;  
        //     }  
        //     var table = $('#text').DataTable();
    
        //     document.getElementById('chkselect').checked=false;
        // }       
       
       
      
    </script>
        
    <script>
    var globaldiv='';
    function setvalueIN(){
    
      $("#alltext").css({"height": "50px",});
      main=[];
      globalarrid=[];
    
      let zone = $('#zone').val();
      $('#rly_1').val(zone);
    
    var arrayArea = $('#department').val();
    $('#dept_1').select2({}).select2('val', arrayArea);
    $('#desig').val('');
    $('#desig').select2().trigger('change');
      if($('#division').val()!='')
        globaldiv=$('#division').val();
      $('#rly_1').select2().trigger('change');
    
    
      let mark_off = $('#mark_officersss').val();
    
    if(mark_off=='Copy To'){
        var myInput = document.getElementById('copyto');
        var officer_val11=myInput.setAttribute('custom-key');
        document.getElementById('alltext').value=document.getElementById('copyto').value;
    }
    else{
          markofficer='markeofficer'+ mark_off
          var myInput = document.getElementById(markofficer);
          var officer_val11=myInput.getAttribute('custom-key');
          document.getElementById('alltext').value=document.getElementById(markofficer).value;   
    }
    if((document.getElementById('alltext').value).length>0)
    {
      globalarrid=String(document.getElementById('alltext').value).split(',');
      main=JSON.parse(officer_val11);
    }
    
    
      
    }
    
    function setCopyValue()
    {
      $("#alltext").css({"height": "50px",});
      let copytobtn = $('#copytobtn').val()
      $('#mark_officersss').val('Copy To')
      $('#rly_1').val('All');
      $('#rly_1').select2().trigger('change');
    }
    
    
    function hidetable(e){
    
      $('#text').show(); $('#text1').hide(); $('#table2').hide(); $('#table3').hide(); $('#table4').hide(); $('#table5').hide();
      $('#mark_officersss').val((e.id).substr(7));
    
    }
    
    $("#zone").select2();
              
                      // Read selected option
    $('#rly').click(function(){
      var username = $('#rly option:selected').text();
      var userid = $('#rly').val();
                    
                       
                        
    });
    
    $("#rly_1").select2();
              
              // Read selected option
    $('#rly_1').click(function(){
      var username = $('#rly_1 option:selected').text();
      var userid = $('#rly_1').val();
                             
    });
    
    $("#div_1").select2();
              
    // Read selected option
    
    $('#div_1').click(function(){
      var username = $('#div_1 option:selected').text();
      var userid = $('#div_1').val();
    });
    
    $("#division").select2();
              
    $('#division').click(function(){
      var username = $('#div option:selected').text();
      var userid = $('#div').val();
    });
    
    $("#department").select2();
              
    $('#department').click(function(){
        var username = $('#department option:selected').text();
        var userid = $('#department').val();
    });
    
    //////////////////////////////////////////////
    $('#desig').select2()
    
    var globaldesigid=[];
    
    
    function selordesel(id)
    {
          var table = $('#textdesig').DataTable();
          table.destroy();
          var table1 = $('#textdesigselect').DataTable();
          table1.destroy();
         
          if(id.checked)
          {
            globaldesigid=[];
            $('#textdesigselect tbody').empty();
            var row='';
            var ele=document.getElementsByName('chkdesig');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox') 
                   {
                    ele[i].checked=true; 
                    let id=ele[i].id;
                    val=ele[i].value;
                    val=val.split(',')
                    globaldesigid.push(id.substring(2,id.length));
                    row += "<tr id='trid"+id+"'>";  
                    row+=  '<td hidden><input checked type="checkbox" id="'+val[0]+'" class="messageCheckbox" value="'+(val[0]+','+val[1])+'" name="chk" ></td>';
                    row += '<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="'+val[0]+'" hidden>'+val[0]+'</td>';
                    row += '</tr>';
                
                   } 
            }  
            $('#textdesigselect tbody').append(row);
            var table1 = $('#textdesigselect').DataTable();
            var table = $('#textdesig').DataTable();
          }
          else 
          {
            var ele=document.getElementsByName('chkdesig');  
            for(var i=0; i<ele.length; i++){  
                if(ele[i].type=='checkbox')  
                    ele[i].checked=false;  
            }  
            globaldesigid=[];
            $('#textdesigselect tbody').empty();
            var table1 = $('#textdesigselect').DataTable();
            var table = $('#textdesig').DataTable();
          }       
    }
    
    function selectdesig(val)
    {
      let id=val.id;
      val=val.value;
      
      var table = $('#textdesigselect').DataTable();
      table.destroy();
      val=val.split(',');
      var row='';
      if(document.getElementById(id).checked==true)
          {
            globaldesigid.push(id.substring(2,id.length));
              row += "<tr id='trid"+id+"'>";  
                  row+=  '<td hidden><input checked type="checkbox" id="'+val[0]+'" class="messageCheckbox" value="'+(val[0]+','+val[1])+'" name="chk" ></td>';
                row += '<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="'+(val[2]+','+val[1])+'" hidden>'+(val[2]+','+val[1])+'</td>';
                row += '</tr>';
                $('#textdesigselect tbody').append(row);
                var table = $('#textdesigselect').DataTable();
          }
          else 
          {
            let id1=id.substring(2,id.length);
            id='trid'+id;
    
                index = globaldesigid.indexOf(id1);
                if (index > -1) { 
                  globaldesigid.splice(index, 1);
                }
    
            var row = document.getElementById(id);
            row.parentNode.removeChild(row);
            var table = $('#textdesigselect').DataTable();
          }       
    }
    
    function getdesigdata()
    {
      let desig=$('#desig').val();
      $('#showdiv1').hide();
      $('#showdiv2').show();
      $('#textdesigselect').DataTable();
      var table = $('#textdesig').DataTable();
        table.destroy();
    
      data={
              'desig':desig,
          }
                $.ajax({
                    type: "GET",
                    url: "{% url 'designation_wise' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(mydata) {
                       let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="selordesel(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        
                        for (let i = 0; i < mydata.length; i++) {
                         
       
    
                          if(globaldesigid.includes(mydata[i]['designation']))
                           { 
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="ab${mydata[i]['empno']}"  value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']},${mydata[i]['empname']}" name="chkdesig" onclick="selectdesig(this)"></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden >
                                ${mydata[i]['empname']},${mydata[i]['desig_longdesc']}</td>`;
                            
                              row += `</tr>`;
                           }
                           else
                           {
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox"  id="ab${mydata[i]['empno']}"  value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']},${mydata[i]['empname']}" name="chkdesig" onclick="selectdesig(this)"></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden >
                                ${mydata[i]['empname']},${mydata[i]['desig_longdesc']}</td>`;
                            
                              row += `</tr>`;
                           }
    
                        }
                        
                        $('#textdesig thead').remove();
                        $('#textdesig tr').remove();
                        $('#textdesig').append(head);
                        $('#textdesig tbody').append(row);
                        
                        $('#textdesig').DataTable();
                          
           
                    },
               
                });
    
    }
    
    //////////////////////////////////////
    $('#desig').click(function(){
        var username = $('#desig option:selected').text();
        var userid = $('#desig').val();
    });

  
    
    $("#dept_1").select2();
              
    $('#dept_1').click(function(){
        var username = $('#desig option:selected').text();
        var userid = $('#desig').val();
    });
    </script>
       
    <script>
    
    function getdivdeptdata()
    {
      $('#showdiv1').show();
      $('#showdiv2').hide();
      getdivwisedata();
      fungetzonedata();
    }
    
    function getdivwisedata()
    {
      $('#showdiv1').show();
      $('#showdiv2').hide();
      var table = $('#text1').DataTable();
        table.destroy();
        $('#text1').hide();
        var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1,
              'dept_1':dept_1,
              'div_1':div_1,
              
            }
                $.ajax({
                    type: "GET",
                    url: "{% url 'division_wise' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                      mydata=response.divwise;
                       let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select1(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                            row += "<tr>";  
                              row+=  `<td><input type="checkbox" id="${mydata[i]['empno']}" class="messageCheckbox" value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']}" name="chktext1" ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                            
                            row += `</tr>`;
                        }
                        $('#text1 thead').remove();
                        $('#text1 tr').remove();
                        $('#text1').append(head);
                        $('#text1 tbody').append(row);
                        $('#text1').show();
                        $('#text1').DataTable();
                          
           
                    },
                });
      document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
               
    }
    
        $('#allgm').click(function() {
          document.getElementById('allboard').checked=false;
          document.getElementById('allphod').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          data={
              'rly_1':rly_1,
              
          } 
          $('#showdiv1').show();
          $('#showdiv2').hide();
          globallistgm='';
           if(this.checked){
            globallistgm= "All GM's/ZR";
              $.ajax({
                    type: "GET",
                    url: "{% url 'gm_list_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allgm;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['empno']}" class="messageCheckbox" value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistgm='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
          });   
    
          
        $('#alldrm').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          var table = $('#text1').DataTable();
          table.destroy();
            var div_1=$('#rly_1').val();
              data={
                  'div_1':div_1,
                  
              }
              globallistdrm='';   
           if(this.checked){
            globallistdrm="All DRM's"
                $.ajax({
                    type: "GET",
                    url: "{% url 'drm_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                      mydata=response.alldrm;
                      let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select1(this)"></th>
                        <th>Division Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['empno']}" class="messageCheckbox" value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']}" name="chktext1"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text1 thead').remove();
                        $('#text1 tr').remove();
                        $('#text1').append(head);
                        $('#text1 tbody').append(row);
                        $('#text1').show();
                        $('#text1').DataTable();       
                    },
      
                });
    
                }
    
                else{
                  globallistdrm=''; 
                  var ele=document.getElementsByName('chktext1');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text1').DataTable();
                }
          });   
    
     
        $('#allphod').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allboard').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          data={
              'rly_1':rly_1,
          }
          globallistphod='';
           if(this.checked){
            globallistphod="All PHOD's";
              $.ajax({
                    type: "GET",
                    url: "{% url 'phod_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allphod;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['empno']}" class="messageCheckbox" value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistphod='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
        }); 
       
        $('#allboard').click(function() {
          $('#showdiv1').show();
          $('#showdiv2').hide();
          document.getElementById('allphod').checked=false;
          document.getElementById('allgm').checked=false;
          var table = $('#text').DataTable();
            table.destroy();
          var rly_1=$('#rly_1').val();
          data={
              'rly_1':rly_1,
              
          }
          globallistbm=''; 
           if(this.checked){
            globallistbm="All Board Member's"; 
              $.ajax({
                    type: "GET",
                    url: "{% url 'board_officers' %}",
                    data: data, //--> send id of checked checkbox on other page
                    success: function(response) {
                     
                        mydata=response.allboard;
                        let row = "";
                        let head = `<thead><tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Board Officers</th></tr></thead>`;
                        for (let i = 0; i < mydata.length; i++) {
                          row += "<tr>";  
                              row+=  `<td><input type="checkbox" checked id="${mydata[i]['empno']}" class="messageCheckbox" value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                        }
                        $('#text thead').remove();
                        $('#text tr').remove();
                        $('#text').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();
                   
                    }, 
                });
    
            }
            else{
              globallistbm='';
              var ele=document.getElementsByName('chktext');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=false;  
              }  
                  var table = $('#text').DataTable();
                }
    }); 
    
     function fungetzonedata()
     {
      $('#showdiv1').show();
      $('#showdiv2').hide();
          var table = $('#text').DataTable();
          table.destroy();
          $('#text').hide();
          var rly_1=$('#rly_1').val();
          var div_1=$('#div_1').val();
          var dept_1=$('#dept_1').val();
          data={
              'rly_1':rly_1,
              'dept_1':dept_1,
              'div_1':div_1,
              
            }
                $.ajax({
                    type: "GET",
                    url: "{% url 'headqwise' %}",
                    data: data,
                    success: function(response) {
                      mydata=response.hqwise;
                      let row = "";
                      let head = `<tr><th>Mark All  <input type="checkbox"  onclick="select21(this)"></th>
                        <th>Zonal Officers</th></tr>`;
                        
                       
                          for (let i = 0; i < mydata.length; i++) {
                              row += "<tr>";  
                              row+=  `<td><input type="checkbox" id="${mydata[i]['empno']}" class="messageCheckbox" value="${mydata[i]['empno']},${mydata[i]['desig_longdesc']}" name="chktext"  ></td>`;
                              row += `<td><input type="text" id="" name="comp_remarks" readonly style="background-Color:lightblue;" value="${mydata[i]['empname']},${mydata[i]['desig_longdesc']}" hidden>
                                ${mydata[i]['desig_longdesc']}</td>`;
                              row += `</tr>`;
                          }
                        
                        $('#text thead').empty();
                        $('#text tbody').empty();
                        //$('#text tr').remove();
                        $('#text thead').append(head);
                        $('#text tbody').append(row);
                        $('#text').show();
                        $('#text').DataTable();      
                       
                    },
                    
                   
                });
                document.getElementById('allphod').checked=false;
      document.getElementById('allgm').checked=false;
      document.getElementById('allboard').checked=false;
      document.getElementById('alldrm').checked=false;
     }
            
    
      $('#rly_1').change(function() {
        var rly_1=$('#rly_1').val();
        if(rly_1 == []) 
          return false;
        let divdata=$('#div_1').val();
       
        // elif(dept_1 == [] && rly_1 == [])
        //   return false;
        // elif(dept_1 != [])
        //   return false;
        data={
            'rly_1':rly_1,
        }
      
        $.ajax({
          type : 'GET',
          url : "{% url 'division_by_rly1' %}",
          dataType : 'json',
          data : data,
    
          success : function(response){
            division=response.division;
            $('#div_1').empty();
            
              for (let i = 0; i < division.length; i++) {
                if(globaldiv.length!=0)
                {
                  if(globaldiv == division[i])
                    { 
                      $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
                    }
                  else
                    $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
                }
                else
                {
                  if(divdata.includes(division[i]))
                    { 
                      $('#div_1').append(`<option selected value="${division[i]}">${division[i]}</option>`);
                    }
                  else
                    $('#div_1').append(`<option  value="${division[i]}">${division[i]}</option>`);
                }
    
              }
              globaldiv=[];
              fungetzonedata();
              $('#div_1').select2().trigger('change');          
          }
    
          
        })
              
      })  
    
    
    
    </script>
            <script>
          //     var officer = $('#officer_code1').val();
          //     officers = JSON.stringify(officer);
          //      document.getElementById('officer_code_hidden').value = officers;
               
    
    
            
          //  $(document).ready(function () {
          //      setSelect2();
          //  });
    
          //  function setSelect2() {
          //      var selectedValues = new Array();
    
          //      if ("{{officer_code1.empno}}" != "") {
          //          var trades = "{{biodetails.instructor_trades}}";
          //          trades = trades.split(',');
          //          selectedValues.length = 0;
          //          selectedValues = trades;
          //      }
    
     
       
          //      $('#officer_code1').select2();
          //      $('#officer_code1').val(selectedValues)
          //      $('#officer_code1').trigger('change');}
    
    
              
           </script>
    
    
    <script>
     
    
    //     $(function(){
    //      var dtToday = new Date();
    
    //      var month = dtToday.getMonth() + 1;
    //      var day = dtToday.getDate();
    //      var year = dtToday.getFullYear();
    
    //      if(month < 10)
    //          month = '0' + month.toString();
    //      if(day < 10)
    //          day = '0' + day.toString();
    
    //      var maxDate = year + '-' + month + '-' + day;    
    //      $('#txtDate2').attr('max', maxDate);
    //  });
    
    
    
    
    
    
    
    function setTitle() {
    
      let zone = $('#zone').val()
      let division = $('#division').val()
      let department = $('#department').val()
      let txtDate = $('#txtDate2').val()
      let user = '{{desig}}'
      let title = 'Inspection of'
      //alert(zone+'----'+ user +'----'+department)
    
      
      var loca = $("#location").val();
      
    
      if(zone==null){
        alert('Please select Rly/Org')
        return false;
      }
      
      if(division == '' || division == null){
        $('#titleinsp').val(title+' '+loca+' '+zone +' by '+user+' date: '+txtDate)
      }
      else{
        $('#titleinsp').val(title+' '+loca+'  '+zone +'/'+division+' by '+user+' date: '+txtDate)
      }
      
    }
    
    //for title autoclear
    // $('#zone').change(function(){
    //   $('#titleinsp').val('')
    // })
    // $('#division').change(function(){
    //   $('#titleinsp').val('')
    // })
    // $('#department').change(function(){
    //   $('#titleinsp').val('')
    // })
    // $('#location').change(function(){
    //   $('#titleinsp').val('')
    // })
    
    
    
    
    
    
    
    
    </script>
    <script>
      $('#zone').change(function() {
        var rly=$('#zone').val();
    
    
          
    
            data={
                'rly_data': JSON.stringify(rly)
                
              }
    
              $.ajax({
                type : 'GET',
                url : "{% url 'getdiv_rly' %}",
                dataType : 'json',
                data : data,
    
                success : function(response){
                  division=response.division;
                              $('#division').empty();
                              $('#division').append(`<option value="" disabled>NA</option>`);
                              for (let i = 0; i < division.length; i++) {
                              $('#division').append(`<option value="${division[i]}">
                                                  ${division[i]}
                                            </option>`);
                                          }
                }
              })
      })
    
    
    
    
    
    function changeColorBtn(el){
      let val = el.id
      if (val == 'addheading'){
        document.getElementById('addheading').style.backgroundColor = "#3333ff";
        document.getElementById('addmech').style.backgroundColor = "#337AB7";
        document.getElementById('addSubmech').style.backgroundColor = "#337AB7";
      }
      else if(val == 'addmech'){
        document.getElementById('addheading').style.backgroundColor = "#337AB7";
        document.getElementById('addmech').style.backgroundColor = "#3333ff";
        document.getElementById('addSubmech').style.backgroundColor = "#337AB7";
      }
      else if(val == 'addSubmech'){
        document.getElementById('addheading').style.backgroundColor = "#337AB7";
        document.getElementById('addmech').style.backgroundColor = "#337AB7";
        document.getElementById('addSubmech').style.backgroundColor = "#3333ff";
      }
    
    }
    
    
    </script>
    
    <script>
    
    
    
    
     
    
      $(function() {
    
          $('input[name="daterange1"]').daterangepicker({
            opens: 'left',
              autoUpdateInput: false,
              maxDate: new Date(),
              // singleDatePicker: true,
              locale: {
                  cancelLabel: 'Clear'
              }
          });
    
          $('input[name="daterange1"]').on('apply.daterangepicker', function(ev, picker) {
              
              if(picker.startDate.format('DD/MM/YYYY') == picker.endDate.format('DD/MM/YYYY')){
                $(this).val(picker.startDate.format('DD/MM/YYYY'))
              }
              else{
                $(this).val(picker.startDate.format('DD/MM/YYYY') + ' to ' + picker.endDate.format('DD/MM/YYYY'));
              
              }
              //setTitle() //for autofill title 2nd comment
          });
    
          $('input[name="daterange1"]').on('cancel.daterangepicker', function(ev, picker) {
              $(this).val('');
          });
    
    });
    
    
    
      $("textarea").each(function () {
      this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
        }).on("input", function () {
          this.style.height = "auto";
          this.style.height = (this.scrollHeight) + "px";
        });
    </script>
    {% endblock %}  